window.bots=function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=7)}([function(t,e,r){"use strict";function a(t){return new Promise(e=>setTimeout(e,t))}function n(t,e){return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/.test(e)?new Date(e):e}function i(t){return"character"==t.type&&!function(t){return!!t.npc}(t)}function o(t=parent.character.items){const e=[];for(let r=0;r<42;r++)t[r]&&e.push({...t[r],index:r});return e}function s(t){for(let e=0;e<42;e++)if(parent.character.items[e]&&parent.character.items[e].name==t)return{...parent.character.items[e],index:e}}function c(t){const e=[];for(let r=0;r<42;r++)parent.character.items[r]&&parent.character.items[r].name==t&&e.push({...parent.character.items[r],index:r});return e}function p(t,e){const r=[];for(let a=0;a<42;a++)parent.character.items[a]&&parent.character.items[a].name==t&&parent.character.items[a].level==e&&r.push({...parent.character.items[a],index:a});return r}function h(t,e){let r=t.attack;return t.apiercing||(t.apiercing=0),t.rpiercing||(t.rpiercing=0),e.armor||(e.armor=0),!t.damage_type&&t.slots.mainhand&&(t.damage_type=G.items[t.slots.mainhand.name].damage),e["1hp"]?[1,1]:("physical"==t.damage_type?r*=damage_multiplier(e.armor-t.apiercing):"magical"==t.damage_type&&(r*=damage_multiplier(e.resistance-t.rpiercing)),[.9*r,1.1*r])}function m(t,e=!1){if(parent.next_skill&&parent.next_skill[t]){const r=parent.next_skill[t].getTime()-Date.now();return e?r+1:r<parent.character.ping?parent.character.ping:r+1}return parent.character.ping}function l(t=parent.character.items){for(let e=0;e<t.length;e++)if(!t[e])return!1;return!0}function u(){const t=new Set;for(const e of parent.party_list)t.add(parent.party[e].type);return t}function f(t=parent.character.items){const e=[];for(let r=0;r<t.length;r++)t[r]||e.push(r);return e}function g(){if("bank"!=parent.character.map)return;const t=[];for(const e in parent.character.bank)if("gold"!=e)for(let r=0;r<42;r++){parent.character.bank[e][r]||t.push({pack:e,index:r})}return t}function d(t){const e=G.skills[t].level;if(e&&e>parent.character.level)return!1;if(parent.character.stoned)return!1;if(parent.character.rip)return!1;const r=G.skills[t].wtype;if(r&&r!=G.items[parent.character.slots.mainhand.name].wtype)return!1;if(G.skills[t].slot)for(const e of G.skills[t].slot)if(parent.character.slots[e[0]].name!=e[1])return!1;if(G.skills[t].class){let e=!1;for(const r of G.skills[t].class)if(r==parent.character.ctype){e=!0;break}if(!e)return!1}let a=0;if(G.skills[t].mp?a=G.skills[t].mp:["attack","heal"].includes(t)&&(a=parent.character.mp_cost),parent.character.mp<a)return!1;if(void 0===parent.next_skill[t])return!0;const n=G.skills[t].share;return n?!parent.next_skill[n]||Date.now()>=parent.next_skill[n].getTime():Date.now()>=parent.next_skill[t].getTime()}function y({canAttackUsWithoutMoving:t,canKillInOneHit:e,canMoveTo:r,isAttacking:a,isAttackingParty:n,isAttackingUs:i,isCtype:o,isMonster:s,isMonsterType:c,isMoving:p,isNPC:m,isPartyMember:l,isPlayer:u,isRIP:f,isWithinDistance:g}){const d=[],y=is_pvp();for(const b in parent.entities){const v=parent.entities[b],_=distance(parent.character,v);!0===t&&v.range>_||(!1===t&&v.range<=_||!0===e&&h(parent.character,v)[0]>v.hp||!1===e&&h(parent.character,v)[0]<=v.hp||(!0!==r||can_move_to(v.real_x,v.real_y))&&(!1===r&&can_move_to(v.real_x,v.real_y)||(!0!==a||"monster"!=v.type||v.target)&&(!1===a&&"monster"==v.type&&v.target||(!0!==a||"character"!=v.type||v.target)&&(!0!==n||"monster"!=v.type||parent.party_list.includes(v.target))&&(!1===n&&"monster"==v.type&&parent.party_list.includes(v.target)||(!0!==n||"character"!=v.type||y)&&(!0===n&&"character"==v.type&&parent.party_list.includes(b)||!0===n&&"Wizard"==parent.character.name||!0===i&&"monster"==v.type&&v.target!=parent.character.name||!1===i&&"monster"==v.type&&v.target==parent.character.name||(!0!==i||"character"!=v.type||y)&&(!0===i&&"character"==v.type&&parent.party_list.includes(b)||!0===i&&"Wizard"==parent.character.name||(void 0===o||v.ctype)&&(void 0!==o&&v.ctype!=o||!0===s&&"monster"!=v.type||!1===s&&"monster"==v.type||(void 0===c||v.mtype)&&(void 0===c||c.includes(v.mtype))&&(!0!==p||v.moving)&&(!1===p&&v.moving||!0===m&&"character"!=v.type||(!0!==m||"character"!=v.type||v.npc)&&(!0!==l||parent.party_list.includes(b))&&(!1===l&&parent.party_list.includes(b)||!0===u&&"character"!=v.type||!0===u&&v.npc||(!0!==f||v.rip)&&(!1===f&&v.rip||void 0!==g&&_>g||d.push(v)))))))))))}return d}function b(){const t=new Set;for(const e in parent.entities){const r=parent.entities[e];r.mtype&&t.add(r.mtype)}return t}function v(t){const e=[];for(const r in G.maps){const a=G.maps[r];if(!a.instance)for(const n of a.monsters||[])if(n.type==t)if(n.boundary)e.push({map:r,x:(n.boundary[0]+n.boundary[2])/2,y:(n.boundary[1]+n.boundary[3])/2});else if(n.boundaries)for(const t of n.boundaries)e.push({map:t[0],x:(t[1]+t[3])/2,y:(t[2]+t[4])/2})}return e}function _(t){const e=v(t);return e[Math.floor(Math.random()*e.length)]}async function k(t,e=9,r=1){if(!s("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs)if("merchant"==G.npcs[e.id].role&&distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}let a=p(t,e);a.length>=r||(a=c(t),a.length<Math.min(2,r)&&await buy_with_gold(t,1))}r.d(e,"r",(function(){return a})),r.d(e,"q",(function(){return n})),r.d(e,"p",(function(){return i})),r.d(e,"j",(function(){return o})),r.d(e,"c",(function(){return s})),r.d(e,"d",(function(){return c})),r.d(e,"e",(function(){return p})),r.d(e,"b",(function(){return h})),r.d(e,"f",(function(){return m})),r.d(e,"o",(function(){return l})),r.d(e,"k",(function(){return u})),r.d(e,"h",(function(){return f})),r.d(e,"g",(function(){return g})),r.d(e,"n",(function(){return d})),r.d(e,"i",(function(){return y})),r.d(e,"m",(function(){return b})),r.d(e,"l",(function(){return _})),r.d(e,"a",(function(){return k}))},function(t,e,r){"use strict";r.d(e,"h",(function(){return n})),r.d(e,"g",(function(){return i})),r.d(e,"d",(function(){return o})),r.d(e,"a",(function(){return s})),r.d(e,"j",(function(){return c})),r.d(e,"i",(function(){return p})),r.d(e,"e",(function(){return h})),r.d(e,"f",(function(){return m})),r.d(e,"b",(function(){return l})),r.d(e,"c",(function(){return u}));var a=r(0);function n(t){if("bank"!=parent.character.map){if(!Object(a.c)("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"merchant"==G.npcs[t.id].role))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}for(const e of Object(a.j)())if(!e.p&&t[e.name]){if(e.level&&e.level>t[e.name])continue;e.q?sell(e.index,e.q):sell(e.index,1)}}}function i(){const t=Object(a.c)("stand0");t&&void 0===parent.character.standed&&parent.open_merchant(t.index)}function o(){void 0!==parent.character.standed&&parent.close_merchant()}function s(t){let e=!1;for(const t of parent.npcs)if("secondhands"==t.id&&distance(parent.character,{x:t.position[0],y:t.position[1]})<350){e=!0;break}if(!e)return;let r=0;parent.socket.once("secondhands",e=>{for(let a=0;a<e.length;a++)if(t.has(e[a].name)){if(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5)break}else if(e[a].p){if(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5)break}else if(G.items[e[a].name].upgrade&&e[a].level>=8){if(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5)break}else if(G.items[e[a].name].compound&&e[a].level>=4&&(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5))break}),parent.socket.emit("secondhands")}function c(t,e){const r=parent.entities[t];if(!r)return;if(distance(parent.character,r)>400)return;const n=Object(a.j)();n.sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:t.level>e.level?-1:void 0);for(let r=0;r<n.length;r++){const a=n[r];e.includes(a.name)?e.splice(e.indexOf(a.name),1):a.q?send_item(t,r,a.q):send_item(t,r,1)}}function p(t,e=0){if(parent.character.gold<=e)return;const r=parent.entities[t];r&&(distance(parent.character,r)>400||send_gold(t,parent.character.gold-e))}async function h(t){if("bank"!=parent.character.map){if(!Object(a.c)("computer")){let t=!1;for(const e of parent.npcs)if("craftsman"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<250){t=!0;break}if(!t)return}for(const e in t)if(!(parent.character.gold<G.dismantle[e].cost))for(let r=t[e];r>0;r--){const t=Object(a.e)(e,r);for(const e of t)parent.socket.emit("dismantle",{num:e.index}),await Object(a.r)(parent.character.ping)}}}function m(t){if(parent.character.q.exchange)return;if("bank"==parent.character.map)return;const e=Object(a.c)("computer"),r=[];if(!e){for(const t of parent.npcs)t.position&&distance(parent.character,{x:t.position[0],y:t.position[1]})<250&&r.push(t.id);if(!r.length)return}const n={};for(const t of Object(a.j)()){const e=G.items[t.name],r=e.e;if(!r||r>t.q)continue;let a;if("quest"==e.type)a=e.quest?G.quests[e.quest].id:"exchange";else if("box"==e.type||"gem"==e.type||"misc"==e.type)a="exchange";else{if("lostearring"!=t.name||2!=t.level)continue;a="pwincess"}n[a]||(n[a]=[]),n[a].push(t)}for(const t in n){if(!r.includes(t)&&!e)continue;const a=n[t][0];return void exchange(a.index)}}async function l(){if("bank"==parent.character.map)return;if(!Object(a.c)("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"fancypots"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.mpot1.g)return;const t={mpot1:9999,hpot1:9999};for(const e in t){const r=t[e],n=Object(a.d)(e).reduce((t,e)=>t+e.q,0);n<r&&await buy_with_gold(e,Math.min(r-n,parent.character.gold/G.items[e].g))}}async function u(){if("bank"==parent.character.map)return;if(!Object(a.c)("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"scrolls"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.scroll0.g)return;const t={scroll0:1e3,scroll1:100,scroll2:10,cscroll0:1e3,cscroll1:100,cscroll2:10};for(const e in t){const r=t[e],n=Object(a.d)(e).reduce((t,e)=>t+e.q,0),i=Math.min(r-n,Math.floor(parent.character.gold/G.items[e].g));n<r&&i>0&&await buy_with_gold(e,i)}}},function(t,e,r){"use strict";(function(t){var e=function(t,e){return t<e};function a(t){if(!(this instanceof a))return new a(t);this.array=[],this.size=0,this.compare=t||e}a.prototype.clone=function(){var t=new a(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},a.prototype.add=function(t){var e,r,a=this.size;for(this.array[this.size]=t,this.size+=1;a>0&&(e=a-1>>1,r=this.array[e],this.compare(t,r));)this.array[a]=r,a=e;this.array[a]=t},a.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},a.prototype._percolateUp=function(t,e){for(var r,a,n=this.array[t];t>0&&(r=t-1>>1,a=this.array[r],e||this.compare(n,a));)this.array[t]=a,t=r;this.array[t]=n},a.prototype._percolateDown=function(t){for(var e,r,a,n=this.size,i=this.size>>>1,o=this.array[t];t<i&&(r=(e=1+(t<<1))+1,a=this.array[e],r<n&&this.compare(this.array[r],a)&&(e=r,a=this.array[r]),this.compare(a,o));)this.array[t]=a,t=e;this.array[t]=o},a.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},a.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},a.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),a=0;if("function"==typeof t&&this.size)for(var n=0;n<this.size&&a<r.length;)t(this.array[n])?(r[a]=this._removeAt(n),a++,n>>=1):n++;return r.length=a,r},a.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},a.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},a.prototype.peek=function(){if(0!=this.size)return this.array[0]},a.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},a.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},a.prototype.trim=function(){this.array=this.array.slice(0,this.size)},a.prototype.isEmpty=function(){return 0===this.size},a.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},a.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,r=this.array,n=new a((function(t,a){return e(r[t],r[a])}));t=Math.min(this.size,t);var i=new Array(t),o=0;for(n.add(0);o<t;){var s=n.poll();i[o++]=this.array[s];var c=1+(s<<1),p=c+1;c<this.size&&n.add(c),p<this.size&&n.add(p)}return i};r.c[r.s]===t&&function(){var t=new a((function(t,e){return t<e}));for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),t.exports=a}).call(this,r(4)(t))},function(t,e,r){"use strict";r.d(e,"a",(function(){return c}));var a=r(2),n=r.n(a),i=r(0),o=r(1);class s{constructor(){this.TOWN_MOVEMENT_COST=250,this.DOOR_TOLERANCE=38,this.TELEPORT_TOLERANCE=73,this.MOVE_TOLERANCE=1,this.TOWN_TOLERANCE=1,this.SLEEP_AFTER_MS=500,this.SLEEP_FOR_MS=50,this.FINISH_CHECK_DISTANCE=200,this.MOVEMENTS=[[[0,25],[0,5]],[[25,0],[5,0]],[[0,-25],[0,-5]],[[-25,0],[-5,0]]],this.USE_BLINK=!0,this.MOVE_ON_FAIL=!1,this.SHOW_MESSAGES=!1,this.MESSAGE_COLOR="#F7600E",this.doorCache=new Map}isMoving(){return null==this.finishedDate&&null!=this.startDate}wasCancelled(t){return!this.startDate||t<this.startDate}stop(){this.reset(),parent.character.c.town&&stop("town"),stop()}reset(){this.finishedDate=void 0,this.startDate=void 0}cleanPosition(t){const e=void 0!==t.real_x?t.real_x:t.x,r=void 0!==t.real_y?t.real_y:t.y;return{map:t.map,x:e,y:r,key:`${t.map}.${e}.${r}`,transportS:t.transportS,transportMap:t.transportMap,transportType:t.transportType}}positionToString(t){return`${t.map}.${t.x}.${t.y}`}stringToPosition(t){const e=t.split("."),r=e[0],a=Number.parseFloat(e[1]),n=Number.parseFloat(e[2]);return{map:r,x:a,real_x:a,y:n,real_y:n}}findDoorPath(t,e,r=new Set,a=new Set){if(r.add(t),t.map==e.map){const a=distance(t,e),n=[];for(const t of r)n.push(t);return n.push(e),[a,n]}const n=[...G.maps[t.map].doors];for(const e of G.maps[t.map].npcs)if("transporter"===e.id){for(const r in G.npcs.transporter.places)r!=t.map&&n.push([e.position[0],e.position[1],-1,-1,r,G.npcs.transporter.places[r]]);break}let i,o=Number.MAX_VALUE;for(const s of n){const n=s[4];if(a.has(n))continue;if(s[7]||s[8])continue;const c={map:t.map,x:s[0],y:s[1],key:`${t.map}.${s[0]}.${s[1]}`,transportS:s[5],transportMap:n,transportType:-1==s[3]?"teleport":"door"},p={map:n,x:G.maps[n].spawns[s[5]][0],y:G.maps[n].spawns[s[5]][1],key:`${n}.${G.maps[n].spawns[s[5]][0]}.${G.maps[n].spawns[s[5]][1]}`},h=new Set(a);h.add(n);const m=new Set(r);m.add(c);const l=distance(t,c)+50;if(o<l)continue;const[u,f]=this.findDoorPath(p,e,m,h);o>u+l&&(o=u+l,i=f)}return[o,i]}heuristic(t,e){return distance(t,e)}smoothPath(t){let e=[];e.push(t[0]);for(let r=0;r<t.length-1;r++){const a=t[r];if("town"==a.transportType){e.push(a);break}let n=r+1;for(let e=r+1;e<t.length;e++){const i=t[e];can_move({map:a.map,x:i.x,y:i.y,going_x:a.x,going_y:a.y,base:parent.character.base})&&(n=e,r=e-1)}n>0&&e.push(t[n])}return e=e.reverse(),e}reconstructPath(t,e,r){const a=[];for(a.push({map:e.map,x:e.x,real_x:e.x,y:e.y,real_y:e.y,key:`${e.map}.${e.x}.${e.y}`,transportMap:e.transportMap,transportType:e.transportType,transportS:e.transportS});t;)a.push({map:t.map,x:t.x,real_x:t.x,y:t.y,real_y:t.y,key:`${t.map}.${t.x}.${t.y}`,transportMap:t.transportMap,transportType:t.transportType,transportS:t.transportS}),t=r.get(t.key);return this.smoothPath(a)}async smartMove(t,e=0){this.reset(),this.startDate=new Date;let r=[];const a=Date.now();this.SHOW_MESSAGES&&game_log("a* - start searching",this.MESSAGE_COLOR);const n=this.findDoorPath(this.cleanPosition(parent.character),this.cleanPosition(t))[1];for(let t=0;t<n.length;t+=2){const a=n[t],i=n[t+1],o=`${a.key}_${i.key}`;let s;this.doorCache.has(o)?s=this.doorCache.get(o):(s="door"==i.transportType?await this.getMovements(a,i,this.DOOR_TOLERANCE):"teleport"==i.transportType?await this.getMovements(a,i,this.TELEPORT_TOLERANCE):await this.getMovements(a,i,e),this.doorCache.set(o,s)),r=r.concat(s)}this.SHOW_MESSAGES&&game_log(`a* - finish searching (${((Date.now()-a)/1e3).toFixed(1)} s)`,this.MESSAGE_COLOR);let i=0;const o=new Promise((t,e)=>{const a=n=>{if(this.wasCancelled(n))return stop(),e("a* - cancelled moving");const o=r[i];if(distance(parent.character,r[r.length-1])<this.MOVE_TOLERANCE)return this.SHOW_MESSAGES&&game_log("a* - done moving",this.MESSAGE_COLOR),this.finishedDate=new Date,void t();if(parent.character.moving||is_transporting(parent.character)||!can_walk(parent.character));else{if(o.map==parent.character.map&&this.USE_BLINK&&can_use("blink")&&distance(parent.character,o)>this.TOWN_MOVEMENT_COST&&parent.character.mp>G.skills.blink.mp){let t=i;for(;t<r.length&&r[t].map===parent.character.map;t++);return i=t-1,setTimeout(()=>{a(n)},900),void use_skill("blink",[r[i].x,r[i].y])}if(o.map==parent.character.map&&"town"==o.transportType)return distance(parent.character,o)<this.TOWN_TOLERANCE?(i+=1,void a(n)):(setTimeout(()=>{a(n)},900),void use_skill("town"));if(parent.character.map!=o.map||!can_move_to(o.x,o.y)){if(this.SHOW_MESSAGES&&game_log("a* - failed moving",this.MESSAGE_COLOR),this.MOVE_ON_FAIL){const t=2*Math.random()-1,e=2*Math.random()-1;move(parent.character.real_x+t,parent.character.real_y+e)}return this.reset(),e("failed moving")}if(distance(parent.character,o)<this.MOVE_TOLERANCE){if("door"!=o.transportType&&"teleport"!=o.transportType)return i+=1,void a(n);if(parent.character.map==o.map)return transport(o.transportMap,o.transportS),i+=1,void setTimeout(()=>{a(n)},100)}else move(o.x,o.y)}setTimeout(()=>{a(n)},40)};this.SHOW_MESSAGES&&game_log("a* - start moving",this.MESSAGE_COLOR),a(this.startDate)});return await o}async getMovements(t,e,r=0,a=this.startDate){const o=this.cleanPosition(t),s=this.cleanPosition(e),c=new Map,p=new Map;p.set(o.key,0);const h=new Map;h.set(o.key,this.heuristic(o,s));const m=new n.a((t,e)=>h.get(t.key)<h.get(e.key));m.add({...o});const l=new Set,u=this.cleanPosition({map:o.map,x:G.maps[o.map].spawns[0][0],y:G.maps[o.map].spawns[0][1],transportType:"town"}),f=p.get(o.key)+this.TOWN_MOVEMENT_COST;u.key!==o.key&&(!p.get(u.key)||f<p.get(u.key))&&(c.set(u.key,o),p.set(u.key,f),h.set(u.key,f+this.heuristic(u,s)),l.has(u.key)||(l.add(u.key),m.add(u)));let g=Date.now();for(;m.size;){const t=m.poll();l.delete(t.key);const e=distance(t,s);if(e<r){const e=this.reconstructPath(t,{...t,transportType:s.transportType,transportMap:s.transportMap,transportS:s.transportS},c);return Promise.resolve(e)}if(e<r+this.FINISH_CHECK_DISTANCE)if(0==r){if(can_move({map:t.map,x:t.x,y:t.y,going_x:s.x,going_y:s.y,base:parent.character.base})){const e=this.reconstructPath(t,s,c);return Promise.resolve(e)}}else{const e=Math.atan2(t.y-s.y,t.x-s.x),a=s.x+Math.cos(e)*r,n=s.y+Math.sin(e)*r,i={map:s.map,x:a,y:n,key:this.positionToString({x:a,y:n,map:s.map}),transportMap:s.transportMap,transportType:s.transportType,transportS:s.transportS};if(can_move({map:t.map,x:t.x,y:t.y,going_x:i.x,going_y:i.y,base:parent.character.base})){const e=this.reconstructPath(t,i,c);return Promise.resolve(e)}}for(const e of this.MOVEMENTS)for(const r of e){const e=this.cleanPosition({map:t.map,x:Math.trunc(t.x+r[0]),y:Math.trunc(t.y+r[1])});if(can_move({map:t.map,x:t.x,y:t.y,going_x:e.x,going_y:e.y,base:parent.character.base})){const a=p.get(t.key)+Math.abs(r[0])+Math.abs(r[1]);(!p.has(e.key)||a<p.get(e.key))&&(c.set(e.key,t),p.set(e.key,a),h.set(e.key,a+this.heuristic(e,s)),l.has(e.key)||(l.add(e.key),m.add(e)))}}if(Date.now()-g>this.SLEEP_AFTER_MS&&(await Object(i.r)(this.SLEEP_FOR_MS),g=Date.now(),this.wasCancelled(a)))return Promise.reject("cancelled")}this.SHOW_MESSAGES&&game_log("a* - failed searching",this.MESSAGE_COLOR);try{let t,e=Number.MAX_VALUE;for(const[r,a]of h){const n=p.get(r);a-n<e&&(e=a-n,t=r)}const r=this.stringToPosition(t),a=this.reconstructPath(r,s,c);return Promise.resolve(a)}catch(t){return Promise.reject("Failed to find a path...")}}}class c{constructor(){this.astar=new s,this.itemsToKeep=["computer","tracker","goldbooster","luckbooster","xpbooster","hpot1","mpot1","jacko","lantern"],this.itemsToSell={shoes:2,pants:2,coat:2,helmet:2,gloves:2,cclaw:2,hpamulet:1,hpbelt:1,maceofthedead:2,ringsj:1,slimestaff:2,spear:2,throwingstars:2,vitearring:1,vitring:1},this.itemsToDismantle={},this.itemsToExchange=new Set(["5bucks","gem0","gem1","seashell","leather","candycane","mistletoe","ornament","candy0","candy1","redenvelopev3","basketofeggs","armorbox","bugbountybox","gift0","gift1","mysterybox","weaponbox","xbox"]),this.itemsToBuy=new Set([...this.itemsToExchange,"dexbelt","intbelt","strbelt","ctristone","dexring","intring","ringofluck","strring","suckerpunch","tristone","dexearring","intearring","lostearring","strearring","amuletofm","dexamulet","intamulet","snring","stramulet","t2dexamulet","t2intamulet","t2stramulet","charmer","ftrinket","jacko","orbg","orbofdex","orbofint","orbofsc","orbofstr","rabbitsfoot","talkingskull","t2quiver","lantern","mshield","quiver","sshield","xshield","angelwings","bcape","cape","ecape","stealthcape","hboots","mrnboots","mwboots","shoes1","wingedboots","xboots","hpants","mrnpants","mwpants","pants1","starkillers","xpants","cdragon","coat1","harmor","mcape","mrnarmor","mwarmor","tshirt0","tshirt1","tshirt2","tshirt3","tshirt4","tshirt6","tshirt7","tshirt8","tshirt88","tshirt9","warpvest","xarmor","eears","fury","helmet1","hhelmet","mrnhat","mwhelmet","partyhat","rednose","xhelmet","gloves1","goldenpowerglove","handofmidas","hgloves","mrngloves","mwgloves","poker","powerglove","xgloves","basher","bataxe","bowofthedead","candycanesword","carrotsword","crossbow","dartgun","firebow","frostbow","froststaff","gbow","harbringer","hbow","merry","oozingterror","ornamentstaff","pmace","t2bow","t3bow","wblade","ascale","bfur","cscale","electronics","feather0","fireblade","goldenegg","goldingot","goldnugget","leather","networkcard","platinumingot","platinumnugget","pleather","snakefang","x0","x1","x2","x3","x4","x5","x6","x7","x8","egg0","egg1","egg2","egg3","egg4","egg5","egg6","egg7","egg8","essenceofether","essenceoffire","essenceoffrost","essenceoflife","essenceofnature","bunnyelixir","candypop","elixirdex0","elixirdex1","elixirdex2","elixirint0","elixirint1","elixirint2","elixirluck","elixirstr0","elixirstr1","elixirstr2","greenbomb","hotchocolate","cscroll3","scroll3","scroll4","bottleofxp","bugbountybox","monstertoken","poison","snakeoil"]),this.holdPosition=!1,this.holdAttack=!1}async mainLoop(){try{if("merchant"!=parent.character.ctype&&(this.equipBetterItems(),this.getMonsterhuntQuest(),await Object(o.b)()),this.getNewYearTreeBuff(),Object(o.e)(this.itemsToDismantle),null==parent.character.slots.elixir){const t=Object(i.d)("candypop");t.length&&equip(t[0].index)}for(const t of Object(i.i)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];r&&(r.giveaway&&(r.list.includes(parent.character.id)||parent.socket.emit("join_giveaway",{slot:e,id:t.id,rid:r.rid})))}for(const t of Object(i.i)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];if(r&&(!r.b&&r.rid&&this.itemsToBuy.has(r.name)&&!(r.price>2*G.items[r.name].g||parent.character.gold<r.price)))if(r.q){const a=Math.min(r.q,Math.floor(parent.character.gold/r.price));parent.socket.emit("trade_buy",{slot:e,id:t.id,rid:r.rid,q:a})}else parent.socket.emit("trade_buy",{slot:e,id:t.id,rid:r.rid,q:1})}this.loot()}catch(t){console.error(t)}setTimeout(async()=>{this.mainLoop()},Math.max(250,parent.character.ping))}run(){this.healLoop(),this.attackLoop(),this.scareLoop(),this.moveLoop(),this.infoLoop(),this.mainLoop()}infoLoop(){const t=JSON.parse(sessionStorage.getItem("party"),i.q)||{};t[parent.character.name]={lastSeen:new Date,shouldSwitchServer:this.shouldSwitchServer(),monsterHuntTargets:this.getMonsterHuntTargets(),items:Object(i.j)(),attack:parent.character.attack,frequency:parent.character.frequency,goldm:parent.character.goldm,last_ms:parent.character.last_ms,luckm:parent.character.luckm,map:parent.character.map,x:parent.character.real_x,y:parent.character.real_y,s:parent.character.s},sessionStorage.setItem("party",JSON.stringify(t));const e=JSON.parse(sessionStorage.getItem("players"),i.q)||{};let r=!1;for(const t of Object(i.i)({isPlayer:!0,isPartyMember:!1}))e[t.id]={lastSeen:new Date,rip:t.rip,map:t.map,x:t.real_x,y:t.real_y,s:t.s,ctype:t.ctype},r=!0;r&&sessionStorage.setItem("players",JSON.stringify(e));const a=JSON.parse(sessionStorage.getItem("npcs"),i.q)||{};r=!1;for(const t of["Angel","Kane"])parent.entities[t]&&(a[t]={lastSeen:new Date,map:parent.entities[t].map,x:parent.entities[t].real_x,y:parent.entities[t].real_y},r=!0);r&&sessionStorage.setItem("npcs",JSON.stringify(a));const n=JSON.parse(sessionStorage.getItem("monsters"),i.q)||{};r=!1;for(const t of Object(i.i)({isMonster:!0}))["fvampire","goldenbat","greenjr","jr","mvampire","phoenix","pinkgoo","snowman","wabbit"].includes(t.mtype)&&(n[t.mtype]={lastSeen:new Date,id:t.id,x:t.real_x,y:t.real_y,map:t.map},r=!0);r&&sessionStorage.setItem("monsters",JSON.stringify(n)),setTimeout(()=>{this.infoLoop()},2e3)}getMonsterHuntTargets(){const t=[];let e=Number.MAX_VALUE;const r=JSON.parse(sessionStorage.getItem("party"),i.q)||{};for(const a of parent.party_list){const n=r[a];if(!n)continue;if(!n.s.monsterhunt||0==n.s.monsterhunt.c)continue;if(!this.targetPriority[n.s.monsterhunt.id])continue;const o=this.targetPriority[n.s.monsterhunt.id].coop;if(o){const t=Object(i.k)();if(o.filter(e=>!t.has(e)).length)continue}const s=n.s.monsterhunt.ms-(Date.now()-n.last_ms.getTime());s<e?(e=s,t.unshift(n.s.monsterhunt.id)):t.push(n.s.monsterhunt.id)}return t}shouldSwitchServer(){if("merchant"==parent.character.ctype)return!0;if(!parent.character.s.monsterhunt)return!1;if(0==parent.character.s.monsterhunt.c)return!1;if(this.getMonsterHuntTargets().length)return!1;for(const t in parent.S)if("grinch"!=t&&!(parent.S[t].hp/parent.S[t].max_hp>.9)&&parent.S[t].live&&this.targetPriority[t])return!1;return!0}loot(){let t=0;const e=JSON.parse(sessionStorage.getItem("party"),i.q)||{};for(const r in parent.chests){const a=parent.chests[r];if(distance(parent.character,a)>800)continue;let n=!0;for(const t of parent.party_list){if(t==parent.character.id)continue;const r=parent.entities[t];if(r&&(!(distance(r,a)>800)&&e[t])){if(["chest3","chest4"].includes(a.skin)){if(parent.character.goldm>=e[t].goldm)continue}else if(parent.character.luckm>=e[t].luckm)continue;n=!1;break}}if(n&&(parent.socket.emit("open_chest",{id:r}),++t>10))break}}async attackLoop(){try{const t=this.getTargets(1);t.length&&this.wantToAttack(t[0])&&(await attack(t[0]),reduce_cooldown("attack",Math.min(...parent.pings)))}catch(t){return"cooldown"==t.reason?void setTimeout(async()=>{this.attackLoop()},Math.min(...parent.pings)-t.remaining):(["not_found","disabled"].includes(t.reason)||console.error(t),void setTimeout(async()=>{this.attackLoop()},Object(i.f)("attack")))}setTimeout(async()=>{this.attackLoop()},Object(i.f)("attack",!0))}scareLoop(){try{const t=Object(i.i)({isAttackingUs:!0,isMonster:!0,isRIP:!1});let e=!1;if(t.length>=3)e=!0;else if(t.length&&!this.targetPriority[t[0].mtype])e=!0;else if(parent.character.c.town&&(t.length>1||1==t.length&&distance(t[0],parent.character)-t[0].range-2*t[0].speed))e=!0;else for(const r of t)if(!(distance(r,parent.character)>r.range||6*Object(i.b)(r,parent.character)[1]*r.frequency<=parent.character.hp)){e=!0;break}if(!Object(i.n)("scare")||!e)return void setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"));if("jacko"==parent.character.slots.orb.name)use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings));else{const t=Object(i.d)("jacko");if(t.length){const e=t[0].index;equip(e),use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings))}}}catch(t){console.error(t)}setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"))}getMovementLocation(t){if(!this.targetPriority[t])return;if(this.targetPriority[t].farmingPosition&&this.targetPriority[t].holdPositionFarm)return this.targetPriority[t].farmingPosition;if(Object(i.m)().has(t))return;if(this.targetPriority[t].farmingPosition)return distance(parent.character,this.targetPriority[t].farmingPosition)<300?void 0:this.targetPriority[t].farmingPosition;if(parent.S[t]){if(!parent.S[t].live)return;return parent.S[t]}const e=Object(i.l)(t);return e||void 0}getMovementTarget(){if(parent.character.rip)return void set_message("RIP");if(parent.character.s.monsterhunt&&0==parent.character.s.monsterhunt.c)return set_message("Finish MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300};for(const t of Object(i.i)({isMonster:!0,isRIP:!1}))if(("goldenbat"==t.mtype||"phoenix"==t.mtype)&&this.targetPriority[t.mtype])return set_message(t.mtype),{target:t.mtype,position:t,range:parent.character.range};const t=JSON.parse(sessionStorage.getItem("monsters"),i.q)||{};for(const e in t){if(!this.targetPriority[e])continue;const r=t[e],a=parent.entities[r.id];if(a&&(r.x=a.real_x,r.y=a.real_y),!(distance(parent.character,r)<2*parent.character.range)||a)return set_message("SP "+e),{target:e,position:r,range:parent.character.range};delete t[e],sessionStorage.setItem("monsters",JSON.stringify(t))}if(G.maps.main.ref.newyear_tree&&!parent.character.s.holidayspirit)return set_message("Xmas Tree"),{target:"newyear_tree",position:G.maps.main.ref.newyear_tree,range:300};if(Object(i.o)())return set_message("Full!"),{target:"merchant",position:{map:"main",x:60,y:-325},range:300};for(const t in parent.S)if(parent.S[t].live&&this.targetPriority[t])return set_message(t),{target:t,position:parent.S[t],range:parent.character.range};const e=JSON.parse(sessionStorage.getItem("party"),i.q)||{},r=this.getMonsterHuntTargets();if(r.length){const t=r[0],a=this.targetPriority[t].coop;if(!a)return set_message("MH "+t),{target:t,position:this.getMovementLocation(t)};{const r=new Set;for(const a of parent.party_list)e[a]&&e[a].monsterHuntTargets&&e[a].monsterHuntTargets[0]==t&&r.add(parent.party[a].type);if(0==a.filter(t=>!r.has(t)).length)return set_message("MH "+t),{target:t,position:this.getMovementLocation(t)}}}return parent.character.s.monsterhunt?this.mainTarget?(set_message(this.mainTarget),{target:this.mainTarget,position:this.getMovementLocation(this.mainTarget)}):void 0:(set_message("New MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300})}moveLoop(){try{if(this.holdPosition||smart.moving)return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));const t=this.movementTarget;if(this.movementTarget=this.getMovementTarget(),this.movementTarget&&this.movementTarget.position){if(!t||this.movementTarget.target!=t.target||t.position&&this.movementTarget.position.map!=t.position.map)return this.astar.stop(),this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));if(!this.astar.isMoving())return this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}const e=this.getTargets(1);e.length&&e[0].mtype==this.movementTarget.target&&this.targetPriority[e[0].mtype]&&!this.targetPriority[e[0].mtype].holdPositionFarm&&this.astar.stop();const r=get_targeted_monster();if(r&&r.rip&&(change_target(null,!0),this.astar.stop()),this.astar.isMoving())return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));if(this.targetPriority[this.movementTarget.target]&&this.targetPriority[this.movementTarget.target].holdPositionFarm)return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));const a=[],n=[],o=[],s=[],c=[],p=[],h=[],m=[];for(const t in parent.entities){const e=parent.entities[t];if(e.rip)continue;if(!this.targetPriority[e.mtype])continue;const r=distance(parent.character,e),l=Math.max(e.range+e.speed,50);l<parent.character.range&&r<l&&(e.hp>Object(i.b)(parent.character,e)[0]||this.targetPriority[e.mtype].holdAttackInEntityRange||e.target==parent.character.name)&&a.push(e),!e.target&&r<50&&n.push(e),r<parent.character.range?(o.push(e),this.movementTarget.target==e.mtype&&s.push(e)):r<2*parent.character.range&&(c.push(e),this.movementTarget.target==e.mtype&&p.push(e)),h.push(e),this.movementTarget.target==e.mtype&&m.push(e)}if(a.length){const t={x:0,y:0};let e=0;for(const r of a)t.x+=r.real_x,t.y+=r.real_y,r.range+r.speed>e&&(e=r.range+r.speed);t.x/=a.length,t.y/=a.length;const r=Math.atan2(parent.character.real_y-t.y,parent.character.real_x-t.x),n=Math.min(parent.character.range,1.5*e),i=(t,e)=>{const r=Math.cos(t)*e,a=Math.sin(t)*e;return{x:parent.character.real_x+r,y:parent.character.real_y+a}};let o=i(r,n),s=0;for(;!can_move_to(o.x,o.y)&&s<180;)s=s<=0?1-s:-s,o=i(r+s*Math.PI/180,n);return move(o.x,o.y),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}if(s.length)return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));if(m.length){let t,e=Number.MAX_VALUE;for(const r of m){const a=distance(parent.character,r);a<e&&(e=a,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}if(h.length){let t,e=Number.MAX_VALUE;for(const r of h){const a=distance(parent.character,r);a<e&&(e=a,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}}catch(t){console.error(t)}setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}async healLoop(){try{if(parent.character.rip)return respawn(),void setTimeout(()=>{this.healLoop()},Object(i.f)("use_town"));if(!Object(i.n)("use_hp"))return void setTimeout(()=>{this.healLoop()},Object(i.f)("use_hp"));const t=["hpot0","hpot1"],e=["mpot0","mpot1"];let r=null,a=null;for(let n=parent.character.items.length-1;n>=0;n--){const i=parent.character.items[n];if(i&&(!a&&t.includes(i.name)?a=i:!r&&e.includes(i.name)&&(r=i),a&&r))break}const n=parent.character.hp/parent.character.max_hp,o=parent.character.mp/parent.character.max_mp;n<=o&&1!=n&&(!a||"hpot0"==a.name&&(parent.character.hp<=parent.character.max_hp-200||parent.character.hp<50)||"hpot1"==a.name&&(parent.character.hp<=parent.character.max_hp-400||parent.character.hp<50))?(use_skill("use_hp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):1!=o&&(!r||"mpot0"==r.name&&(parent.character.mp<=parent.character.max_mp-300||parent.character.mp<50)||"mpot1"==r.name&&(parent.character.mp<=parent.character.max_mp-500||parent.character.mp<50))?(use_skill("use_mp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):n<o?(use_skill("regen_hp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):o<n&&(use_skill("regen_mp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings)))}catch(t){console.error(t)}setTimeout(()=>{this.healLoop()},Object(i.f)("use_hp"))}getNewYearTreeBuff(){G.maps.main.ref.newyear_tree&&(parent.character.s.holidayspirit||distance(parent.character,G.maps.main.ref.newyear_tree)>400||parent.socket.emit("interaction",{type:"newyear_tree"}))}getMonsterhuntQuest(){distance(parent.character,G.maps.main.ref.monsterhunter)>400||(parent.character.s.monsterhunt?0==parent.character.s.monsterhunt.c&&parent.socket.emit("monsterhunt"):parent.socket.emit("monsterhunt"))}parseCM(t,e){if(parent.party_list.includes(t)||parent.character.name==t||["earthiverse","earthMag","earthMag2"].includes(t)||"monster"==e.message){if("info"==e.message){const r=JSON.parse(sessionStorage.getItem("party"),i.q)||{};r[t]=e.info,sessionStorage.setItem("party",JSON.stringify(r))}else if("monster"==e.message){const t=JSON.parse(sessionStorage.getItem("monsters"),i.q)||{};t[e.id]=e.info,sessionStorage.setItem("monsters",JSON.stringify(t))}else if("npc"==e.message){const t=JSON.parse(sessionStorage.getItem("npcs"),i.q)||{};t[e.id]=e.info,sessionStorage.setItem("npcs",JSON.stringify(t))}else if("player"==e.message){const t=JSON.parse(sessionStorage.getItem("players"),i.q)||{};t[e.id]=e.info,sessionStorage.setItem("players",JSON.stringify(t))}else if("chests"==e.message)for(const t in e.chests)parent.chests[t]||(parent.chests[t]=e.chests[t])}else game_log("Blocked CM from "+t)}equipBetterItems(){try{const t=Object(i.j)();if(this.movementTarget.target&&this.targetPriority[this.movementTarget.target])for(const e of this.targetPriority[this.movementTarget.target].equip||[]){let r=!1;for(const t in parent.character.slots){const a=parent.character.slots[t];if(a&&a.name==e){r=!0;break}}if(!r)for(const r of t)if(r.name==e){G.classes[parent.character.ctype].doublehand[G.items[e].wtype]&&unequip("offhand"),equip(r.index);break}}for(const e in parent.character.slots){let r,a=parent.character.slots[e];if(a){for(const e of t)e.name==a.name&&(!e.level||e.level<=a.level||(a=e,r=e));r&&equip(r.index,e)}}}catch(t){console.error(t)}}getTargets(t=1,e=parent.character.range){const r=[],a=parent.party_list,o=new Set;for(const t in parent.entities)if(a.includes(t)){const e=parent.entities[t].target;e&&o.add(e)}const s=new n.a((t,e)=>t.priority>e.priority);for(const t in parent.entities){const r=parent.entities[t];if(r.rip)continue;if(parent.party_list.includes(t))continue;if(!is_pvp()&&"monster"!=r.type)continue;if(is_pvp()&&parent.party_list.includes(t))continue;if(!this.targetPriority[r.mtype]&&r.target!=parent.character.name)continue;let a=this.targetPriority[r.mtype]?this.targetPriority[r.mtype].priority:0;const n=distance(parent.character,r);if(n>e)continue;a-=n,o.has(t)&&(this.targetPriority[r.mtype]&&this.targetPriority[r.mtype].coop&&(a+=parent.character.range),r.hp<=Object(i.b)(parent.character,r)[0]&&(a-=parent.character.range)),r.mtype==this.mainTarget&&(a+=250),this.movementTarget&&r.mtype==this.movementTarget.target&&(a+=1e3),r.target==parent.character.name&&(a+=2e3),r.cooperative&&(a+=1e3*(r.max_hp-r.hp)/r.max_hp);const c={id:r.id,priority:a};s.add(c)}for(;r.length<t&&s.size>0;){const t=parent.entities[s.poll().id];t&&r.push(t)}return r.length>0&&change_target(r[0],!0),r}wantToAttack(t,e="attack"){if(!Object(i.n)(e))return!1;if(parent.character.c.town)return!1;let r=G.skills[e].range?G.skills[e].range:parent.character.range;const a=distance(parent.character,t);if(G.skills[e].range_multiplier&&(r*=G.skills[e].range_multiplier),a>r)return!1;const n=G.skills[e].mp?G.skills[e].mp:parent.character.mp_cost;if(parent.character.mp<n)return!1;if("attack"!=e&&t.immune)return!1;if("attack"!=e&&t["1hp"])return!1;if(!is_pvp()&&"monster"==t.type&&!this.targetPriority[t.mtype])return!1;if(!t.target){if(this.holdAttack)return!1;if((smart.moving||this.astar.isMoving())&&this.movementTarget&&this.movementTarget.target&&this.movementTarget.target!=t.mtype&&this.targetPriority[t.mtype].holdAttackWhileMoving)return!1;if(this.targetPriority[t.mtype].holdAttackInEntityRange&&a<=t.range)return!1;if(this.targetPriority[t.mtype].coop){const e=[parent.character.ctype];for(const t of parent.party_list){const r=parent.entities[t];r&&(r.rip||"priest"==r.ctype&&distance(parent.character,r)>r.range||e.push(r.ctype))}for(const r of this.targetPriority[t.mtype].coop)if(!e.includes(r))return!1}if(5*Object(i.b)(t,parent.character)[1]*t.frequency>parent.character.hp&&a<=t.range)return!1}return!0}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},,,function(t,e,r){"use strict";r.r(e),r.d(e,"ranger",(function(){return s}));var a=r(3),n=r(1),i=r(0);class o extends a.a{constructor(){super(),this.targetPriority={arcticbee:{priority:0,equip:["t2bow","t2quiver"]},armadillo:{priority:0,equip:["t2bow","t2quiver"]},bat:{priority:0,farmingPosition:{map:"cave",x:-200,y:-450},equip:["bowofthedead","t2quiver"]},bbpompom:{coop:["priest"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:0,farmingPosition:{map:"winter_cave",x:-50,y:-100},equip:["t2bow","t2quiver"]},bee:{priority:50,holdPositionFarm:!0,farmingPosition:{map:"main",x:550,y:1100},equip:["t2bow","t2quiver"]},bigbird:{priority:0,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,equip:["firebow","t2quiver"]},boar:{priority:0,holdAttackWhileMoving:!0,equip:["firebow","t2quiver"]},booboo:{coop:["priest"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"spookytown",x:190,y:-650},equip:["hbow","quiver"]},cgoo:{holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,priority:0,equip:["t2bow","t2quiver"]},crab:{priority:0,equip:["t2bow","t2quiver"]},crabx:{priority:100,equip:["t2bow","t2quiver"]},croc:{priority:100,equip:["t2bow","t2quiver"]},fireroamer:{coop:["priest","warrior"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"desertland",x:150,y:-650},equip:["firebow","t2quiver"]},fvampire:{coop:["warrior","priest"],priority:0,holdAttackWhileMoving:!0,equip:["firebow","t2quiver"]},ghost:{coop:["priest"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"halloween",x:400,y:-1200},equip:["firebow","t2quiver"]},goldenbat:{priority:1e3,equip:["t2bow","t2quiver"]},goo:{priority:-50,equip:["t2bow","t2quiver"]},greenjr:{priority:1e3,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,equip:["firebow","t2quiver"]},hen:{priority:0,equip:["t2bow","t2quiver"]},iceroamer:{holdAttackWhileMoving:!0,priority:0,equip:["t2bow","t2quiver"]},jr:{priority:1e3,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,equip:["firebow","t2quiver"]},mechagnome:{coop:["priest","ranger"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:0,farmingPosition:{map:"cyberland",x:150,y:-150},equip:["firebow","t2quiver"]},minimush:{priority:100,equip:["t2bow","t2quiver"]},mole:{coop:["priest","warrior"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:0,farmingPosition:{map:"tunnel",x:-50,y:-75},equip:["firebow","t2quiver"]},mummy:{coop:["priest","warrior"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"spookytown",x:175,y:-1060},equip:["firebow","t2quiver"]},mrgreen:{priority:1e3,equip:["firebow","t2quiver"]},mrpumpkin:{priority:1e3,equip:["firebow","t2quiver"]},mvampire:{priority:0,coop:["priest"],equip:["firebow","t2quiver"]},oneeye:{coop:["priest","warrior"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"level2w",x:-100,y:0},equip:["firebow","t2quiver"]},osnake:{priority:500,equip:["t2bow","t2quiver"]},phoenix:{priority:1e3,equip:["firebow","t2quiver"]},pinkgoo:{priority:1e3,equip:["bow","t2quiver"]},poisio:{priority:250,equip:["t2bow","t2quiver"]},porcupine:{priority:0,equip:["t2bow","t2quiver"]},prat:{holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,holdPositionFarm:!0,priority:0,farmingPosition:{map:"level1",x:-296.5,y:557.5},equip:["hbow","quiver"]},rat:{priority:0,equip:["t2bow","t2quiver"]},rooster:{priority:0,equip:["t2bow","t2quiver"]},scorpion:{priority:250,equip:["bowofthedead","t2quiver"]},snake:{priority:0,farmingPosition:{map:"main",x:-74,y:1904},equip:["t2bow","t2quiver"]},snowman:{priority:1e3,equip:["t2bow","t2quiver"]},spider:{priority:100,equip:["bowofthedead","t2quiver"]},squig:{priority:100,equip:["hbow","quiver"]},squigtoad:{priority:250,equip:["hbow","quiver"]},stoneworm:{holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,priority:0,equip:["bowofthedead","t2quiver"]},tortoise:{priority:0,equip:["t2bow","t2quiver"]},wolf:{coop:["priest","warrior"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"winterland",x:375,y:-2475},equip:["firebow","t2quiver"]},wolfie:{priority:0,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,equip:["firebow","t2quiver"]},xscorpion:{priority:0,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"halloween",x:-230,y:570},equip:["firebow","t2quiver"]}},this.mainTarget="scorpion",this.itemsToKeep.push("bow","bowofthedead","crossbow","cupid","firebow","hbow","merry","t2bow","t3bow","quiver","t2quiver")}run(){super.run(),this.superShotLoop(),this.huntersmarkLoop(),this.fourFingersLoop()}async mainLoop(){try{Object(n.j)("earthMer",this.itemsToKeep),Object(n.i)("earthMer",1e5),Object(n.h)(this.itemsToSell),this.createParty(["earthMer","earthMag","earthMag2","earthWar","earthWar2","earthPri","earthPri2"]),await super.mainLoop()}catch(t){console.error(t),setTimeout(async()=>{this.mainLoop()},250)}}huntersmarkLoop(){try{const t=this.getTargets(1);t.length&&!t[0].s.marked&&t[0].hp>5*Object(i.b)(parent.character,t[0])[0]&&this.wantToAttack(t[0],"huntersmark")&&(use_skill("huntersmark",t[0]),reduce_cooldown("huntersmark",Math.min(...parent.pings)))}catch(t){console.error(t)}setTimeout(()=>{this.huntersmarkLoop()},Object(i.f)("huntersmark"))}async trackLoop(){try{Object(i.n)("track")&&is_pvp()&&(use_skill("track"),reduce_cooldown("track",Math.min(...parent.pings)))}catch(t){console.error(t)}setTimeout(()=>{this.trackLoop()},Object(i.f)("track"))}async fourFingersLoop(){try{const t=Object(i.i)({isPlayer:!0,isAttackingParty:!0,isWithinDistance:G.skills["4fingers"].range});Object(i.n)("4fingers")&&t.length>0&&!parent.character.stoned&&distance(parent.character,t[0])<=120&&Object(i.p)(t[0])&&t[0].target==parent.character.name&&parent.character.hp<10*t[0].attack&&(use_skill("4fingers",t[0]),reduce_cooldown("4fingers",Math.min(...parent.pings)))}catch(t){console.error(t)}setTimeout(()=>{this.fourFingersLoop()},Object(i.f)("4fingers"))}async superShotLoop(){try{for(const t of this.getTargets(10,parent.character.range*G.skills.supershot.range_multiplier))if(this.wantToAttack(t,"supershot")){await use_skill("supershot",t),reduce_cooldown("supershot",Math.min(...parent.pings));break}}catch(t){console.error(t)}setTimeout(()=>{this.superShotLoop()},Object(i.f)("supershot"))}async attackLoop(){try{const t=this.getTargets(6),e=t.shift();if(t.length>=4&&this.wantToAttack(e,"5shot")){const r=[e];for(const e of t)if((e.target||!(e.hp>.5*Object(i.b)(parent.character,e)[0]))&&(r.push(e),5==r.length))break;if(5==r.length)return await use_skill("5shot",r),reduce_cooldown("attack",Math.min(...parent.pings)),void setTimeout(async()=>{this.attackLoop()},Object(i.f)("attack"))}if(t.length>=2&&this.wantToAttack(e,"3shot")){const r=[e];for(const e of t)if((e.target||!(e.hp>.7*Object(i.b)(parent.character,e)[0]))&&(r.push(e),3==r.length))break;if(3==r.length)return await use_skill("3shot",r),reduce_cooldown("attack",Math.min(...parent.pings)),void setTimeout(async()=>{this.attackLoop()},Object(i.f)("attack"))}const r={...parent.character};if(r.apiercing+=G.skills.piercingshot.apiercing,r.attack*=G.skills.piercingshot.damage_multiplier,e&&this.wantToAttack(e,"piercingshot")&&Object(i.b)(r,e)[0]>Object(i.b)(parent.character,e)[0])return await use_skill("piercingshot",e),reduce_cooldown("attack",Math.min(...parent.pings)),void setTimeout(async()=>{this.attackLoop()},Object(i.f)("attack"))}catch(t){return["cooldown","not_found","disabled"].includes(t.reason)||console.error(t),void setTimeout(async()=>{this.attackLoop()},Object(i.f)("attack"))}await super.attackLoop()}createParty(t){if(!(parent.party_list.length>=4))for(const e of t)parent.party[e]||send_party_invite(e)}}const s=new o}]);