window.bots=function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=9)}([function(t,e,r){"use strict";r.d(e,"r",(function(){return n})),r.d(e,"q",(function(){return i})),r.d(e,"p",(function(){return o})),r.d(e,"j",(function(){return s})),r.d(e,"c",(function(){return c})),r.d(e,"d",(function(){return p})),r.d(e,"e",(function(){return h})),r.d(e,"b",(function(){return l})),r.d(e,"f",(function(){return m})),r.d(e,"o",(function(){return u})),r.d(e,"k",(function(){return f})),r.d(e,"h",(function(){return g})),r.d(e,"g",(function(){return d})),r.d(e,"n",(function(){return y})),r.d(e,"i",(function(){return b})),r.d(e,"m",(function(){return _})),r.d(e,"l",(function(){return x})),r.d(e,"a",(function(){return k}));var a=function(t,e,r,a){return new(r||(r=Promise))((function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))};function n(t){return new Promise(e=>setTimeout(e,t))}function i(t,e){return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e)?new Date(e):e}function o(t){return"character"==t.type&&!function(t){return!!t.npc}(t)}function s(t=parent.character.items){const e=[];for(let r=0;r<42;r++)t[r]&&e.push(Object.assign(Object.assign({},t[r]),{index:r}));return e}function c(t){for(let e=0;e<42;e++)if(parent.character.items[e]&&parent.character.items[e].name==t)return Object.assign(Object.assign({},parent.character.items[e]),{index:e})}function p(t){const e=[];for(let r=0;r<42;r++)parent.character.items[r]&&parent.character.items[r].name==t&&e.push(Object.assign(Object.assign({},parent.character.items[r]),{index:r}));return e}function h(t,e){const r=[];for(let a=0;a<42;a++)parent.character.items[a]&&parent.character.items[a].name==t&&parent.character.items[a].level==e&&r.push(Object.assign(Object.assign({},parent.character.items[a]),{index:a}));return r}function l(t,e){let r=t.attack;return t.apiercing||(t.apiercing=0),t.rpiercing||(t.rpiercing=0),e.armor||(e.armor=0),!t.damage_type&&t.slots.mainhand&&(t.damage_type=G.items[t.slots.mainhand.name].damage),e["1hp"]?[1,1]:("physical"==t.damage_type?r*=damage_multiplier(e.armor-t.apiercing):"magical"==t.damage_type&&(r*=damage_multiplier(e.resistance-t.rpiercing)),[.9*r,1.1*r])}function m(t,e=!1){if(parent.next_skill&&parent.next_skill[t]){const r=parent.next_skill[t].getTime()-Date.now();return e?r+1:r<parent.character.ping?parent.character.ping:r+1}return parent.character.ping}function u(t=parent.character.items){for(let e=0;e<t.length;e++)if(!t[e])return!1;return!0}function f(){const t=new Set;for(const e of parent.party_list)t.add(parent.party[e].type);return t}function g(t=parent.character.items){const e=[];for(let r=0;r<t.length;r++)t[r]||e.push(r);return e}function d(){if("bank"!=parent.character.map)return;const t=[];for(const e in parent.character.bank)if("gold"!=e)for(let r=0;r<42;r++){parent.character.bank[e][r]||t.push({pack:e,index:r})}return t}function y(t){const e=G.skills[t].level;if(e&&e>parent.character.level)return!1;if(parent.character.stoned)return!1;if(parent.character.rip)return!1;const r=G.skills[t].wtype;if(r&&r!=G.items[parent.character.slots.mainhand.name].wtype)return!1;if(G.skills[t].slot)for(const e of G.skills[t].slot)if(parent.character.slots[e[0]].name!=e[1])return!1;if(G.skills[t].class){let e=!1;for(const r of G.skills[t].class)if(r==parent.character.ctype){e=!0;break}if(!e)return!1}let a=0;if(G.skills[t].mp?a=G.skills[t].mp:["attack","heal"].includes(t)&&(a=parent.character.mp_cost),parent.character.mp<a)return!1;if(void 0===parent.next_skill[t])return!0;const n=G.skills[t].share;return n?!parent.next_skill[n]||Date.now()>=parent.next_skill[n].getTime():Date.now()>=parent.next_skill[t].getTime()}function b({canAttackUsWithoutMoving:t,canKillInOneHit:e,canMoveTo:r,isAttacking:a,isAttackingParty:n,isAttackingUs:i,isCtype:o,isMonster:s,isMonsterType:c,isMoving:p,isNPC:h,isPartyMember:m,isPlayer:u,isRIP:f,isWithinDistance:g}){const d=[],y=is_pvp();for(const b in parent.entities){const _=parent.entities[b],v=distance(parent.character,_);!0===t&&_.range>v||(!1===t&&_.range<=v||!0===e&&l(parent.character,_)[0]>_.hp||!1===e&&l(parent.character,_)[0]<=_.hp||(!0!==r||can_move_to(_.real_x,_.real_y))&&(!1===r&&can_move_to(_.real_x,_.real_y)||(!0!==a||"monster"!=_.type||_.target)&&(!1===a&&"monster"==_.type&&_.target||(!0!==a||"character"!=_.type||_.target)&&(!0!==n||"monster"!=_.type||parent.party_list.includes(_.target))&&(!1===n&&"monster"==_.type&&parent.party_list.includes(_.target)||(!0!==n||"character"!=_.type||y)&&(!0===n&&"character"==_.type&&parent.party_list.includes(b)||!0===n&&"Wizard"==parent.character.name||!0===i&&"monster"==_.type&&_.target!=parent.character.name||!1===i&&"monster"==_.type&&_.target==parent.character.name||(!0!==i||"character"!=_.type||y)&&(!0===i&&"character"==_.type&&parent.party_list.includes(b)||!0===i&&"Wizard"==parent.character.name||(void 0===o||_.ctype)&&(void 0!==o&&_.ctype!=o||!0===s&&"monster"!=_.type||!1===s&&"monster"==_.type||(void 0===c||_.mtype)&&(void 0===c||c.includes(_.mtype))&&(!0!==p||_.moving)&&(!1===p&&_.moving||!0===h&&"character"!=_.type||(!0!==h||"character"!=_.type||_.npc)&&(!0!==m||parent.party_list.includes(b))&&(!1===m&&parent.party_list.includes(b)||!0===u&&"character"!=_.type||!0===u&&_.npc||(!0!==f||_.rip)&&(!1===f&&_.rip||void 0!==g&&v>g||d.push(_)))))))))))}return d}function _(){const t=new Set;for(const e in parent.entities){const r=parent.entities[e];r.mtype&&t.add(r.mtype)}return t}function v(t){const e=[];for(const r in G.maps){const a=G.maps[r];if(!a.instance)for(const n of a.monsters||[])if(n.type==t)if(n.boundary)e.push({map:r,x:(n.boundary[0]+n.boundary[2])/2,y:(n.boundary[1]+n.boundary[3])/2});else if(n.boundaries)for(const t of n.boundaries)e.push({map:t[0],x:(t[1]+t[3])/2,y:(t[2]+t[4])/2})}return e}function x(t){const e=v(t);return e[Math.floor(Math.random()*e.length)]}function k(t,e=9,r=1){return a(this,void 0,void 0,(function*(){if(!c("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs)if("merchant"==G.npcs[e.id].role&&distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}let a=h(t,e);a.length>=r||(a=p(t),a.length<Math.min(2,r)&&(yield buy_with_gold(t,1)))}))}},function(t,e,r){"use strict";r.d(e,"h",(function(){return i})),r.d(e,"g",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"a",(function(){return c})),r.d(e,"j",(function(){return p})),r.d(e,"i",(function(){return h})),r.d(e,"e",(function(){return l})),r.d(e,"f",(function(){return m})),r.d(e,"b",(function(){return u})),r.d(e,"c",(function(){return f}));var a=r(0),n=function(t,e,r,a){return new(r||(r=Promise))((function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))};function i(t){if("bank"!=parent.character.map){if(!Object(a.c)("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"merchant"==G.npcs[t.id].role))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}for(const e of Object(a.j)())if(!e.p&&t[e.name]){if(e.level&&e.level>t[e.name])continue;e.q?sell(e.index,e.q):sell(e.index,1)}}}function o(){const t=Object(a.c)("stand0");t&&void 0===parent.character.standed&&parent.open_merchant(t.index)}function s(){void 0!==parent.character.standed&&parent.close_merchant()}function c(t){let e=!1;for(const t of parent.npcs)if("secondhands"==t.id&&distance(parent.character,{x:t.position[0],y:t.position[1]})<350){e=!0;break}if(!e)return;let r=0;parent.socket.once("secondhands",e=>{for(let a=0;a<e.length;a++)if(t.has(e[a].name)){if(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5)break}else if(e[a].p){if(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5)break}else if(G.items[e[a].name].upgrade&&e[a].level>=8){if(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5)break}else if(G.items[e[a].name].compound&&e[a].level>=4&&(parent.socket.emit("sbuy",{rid:e[a].rid}),++r>=5))break}),parent.socket.emit("secondhands")}function p(t,e){const r=parent.entities[t];if(!r)return;if(distance(parent.character,r)>400)return;const a=new Set(e);for(let e=0;e<parent.character.items.length;e++){const r=parent.character.items[e];r&&(a.has(r.name)?a.delete(r.name):r.q?send_item(t,e,r.q):send_item(t,e,1))}}function h(t,e=0){if(parent.character.gold<=e)return;const r=parent.entities[t];r&&(distance(parent.character,r)>400||send_gold(t,parent.character.gold-e))}function l(t){return n(this,void 0,void 0,(function*(){if("bank"!=parent.character.map){if(!Object(a.c)("computer")){let t=!1;for(const e of parent.npcs)if("craftsman"==e.id&&distance(parent.character,{x:e.position[0],y:e.position[1]})<250){t=!0;break}if(!t)return}for(const e in t)if(!(parent.character.gold<G.dismantle[e].cost))for(let r=t[e];r>0;r--){const t=Object(a.e)(e,r);for(const e of t)parent.socket.emit("dismantle",{num:e.index}),yield Object(a.r)(parent.character.ping)}}}))}function m(t){if(parent.character.q.exchange)return;if("bank"==parent.character.map)return;const e=Object(a.c)("computer"),r=[];if(!e){for(const t of parent.npcs)t.position&&distance(parent.character,{x:t.position[0],y:t.position[1]})<250&&r.push(t.id);if(!r.length)return}const n={};for(const t of Object(a.j)()){const e=G.items[t.name],r=e.e;if(!r||r>t.q)continue;let a;if("quest"==e.type)a=e.quest?G.quests[e.quest].id:"exchange";else if("box"==e.type||"gem"==e.type||"misc"==e.type)a="exchange";else{if("lostearring"!=t.name||2!=t.level)continue;a="pwincess"}n[a]||(n[a]=[]),n[a].push(t)}for(const t in n){if(!r.includes(t)&&!e)continue;const a=n[t][0];return void exchange(a.index)}}function u(){return n(this,void 0,void 0,(function*(){if("bank"==parent.character.map)return;if(!Object(a.c)("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"fancypots"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.mpot1.g)return;const t={mpot1:9999,hpot1:9999};for(const e in t){const r=t[e],n=Object(a.d)(e).reduce((t,e)=>t+e.q,0);n<r&&(yield buy_with_gold(e,Math.min(r-n,parent.character.gold/G.items[e].g)))}}))}function f(){return n(this,void 0,void 0,(function*(){if("bank"==parent.character.map)return;if(!Object(a.c)("computer")){let t=!1;if(!G.maps[parent.character.map].npcs)return;for(const e of G.maps[parent.character.map].npcs.filter(t=>"scrolls"==t.id))if(distance(parent.character,{x:e.position[0],y:e.position[1]})<350){t=!0;break}if(!t)return}if(parent.character.gold<G.items.scroll0.g)return;const t={scroll0:1e3,scroll1:100,scroll2:10,cscroll0:1e3,cscroll1:100,cscroll2:10};for(const e in t){const r=t[e],n=Object(a.d)(e).reduce((t,e)=>t+e.q,0),i=Math.min(r-n,Math.floor(parent.character.gold/G.items[e].g));n<r&&i>0&&(yield buy_with_gold(e,i))}}))}},function(t,e,r){"use strict";(function(t){var e=function(t,e){return t<e};function a(t){if(!(this instanceof a))return new a(t);this.array=[],this.size=0,this.compare=t||e}a.prototype.clone=function(){var t=new a(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},a.prototype.add=function(t){var e,r,a=this.size;for(this.array[this.size]=t,this.size+=1;a>0&&(e=a-1>>1,r=this.array[e],this.compare(t,r));)this.array[a]=r,a=e;this.array[a]=t},a.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},a.prototype._percolateUp=function(t,e){for(var r,a,n=this.array[t];t>0&&(r=t-1>>1,a=this.array[r],e||this.compare(n,a));)this.array[t]=a,t=r;this.array[t]=n},a.prototype._percolateDown=function(t){for(var e,r,a,n=this.size,i=this.size>>>1,o=this.array[t];t<i&&(r=(e=1+(t<<1))+1,a=this.array[e],r<n&&this.compare(this.array[r],a)&&(e=r,a=this.array[r]),this.compare(a,o));)this.array[t]=a,t=e;this.array[t]=o},a.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},a.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},a.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),a=0;if("function"==typeof t&&this.size)for(var n=0;n<this.size&&a<r.length;)t(this.array[n])?(r[a]=this._removeAt(n),a++,n>>=1):n++;return r.length=a,r},a.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},a.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},a.prototype.peek=function(){if(0!=this.size)return this.array[0]},a.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},a.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},a.prototype.trim=function(){this.array=this.array.slice(0,this.size)},a.prototype.isEmpty=function(){return 0===this.size},a.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},a.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,r=this.array,n=new a((function(t,a){return e(r[t],r[a])}));t=Math.min(this.size,t);var i=new Array(t),o=0;for(n.add(0);o<t;){var s=n.poll();i[o++]=this.array[s];var c=1+(s<<1),p=c+1;c<this.size&&n.add(c),p<this.size&&n.add(p)}return i};r.c[r.s]===t&&function(){var t=new a((function(t,e){return t<e}));for(t.add(1),t.add(0),t.add(5),t.add(4),t.add(3);!t.isEmpty();)console.log(t.poll())}(),t.exports=a}).call(this,r(4)(t))},function(t,e,r){"use strict";r.d(e,"a",(function(){return h}));var a=r(2),n=r.n(a),i=r(0),o=r(1),s=function(t,e,r,a){return new(r||(r=Promise))((function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))};class c{constructor(){this.TOWN_MOVEMENT_COST=250,this.DOOR_TOLERANCE=38,this.TELEPORT_TOLERANCE=73,this.MOVE_TOLERANCE=1,this.TOWN_TOLERANCE=1,this.SLEEP_AFTER_MS=500,this.SLEEP_FOR_MS=50,this.FINISH_CHECK_DISTANCE=200,this.MOVEMENTS=[[[0,25],[0,5]],[[25,0],[5,0]],[[0,-25],[0,-5]],[[-25,0],[-5,0]]],this.USE_BLINK=!0,this.MOVE_ON_FAIL=!1,this.SHOW_MESSAGES=!1,this.MESSAGE_COLOR="#F7600E",this.doorCache=new Map}isMoving(){return null==this.finishedDate&&null!=this.startDate}wasCancelled(t){return!this.startDate||t<this.startDate}stop(){this.reset(),parent.character.c.town&&stop("town"),stop()}reset(){this.finishedDate=void 0,this.startDate=void 0}cleanPosition(t){const e=void 0!==t.real_x?t.real_x:t.x,r=void 0!==t.real_y?t.real_y:t.y;return{map:t.map,x:e,y:r,key:`${t.map}.${e}.${r}`,transportS:t.transportS,transportMap:t.transportMap,transportType:t.transportType}}positionToString(t){return`${t.map}.${t.x}.${t.y}`}stringToPosition(t){const e=t.split("."),r=e[0],a=Number.parseFloat(e[1]),n=Number.parseFloat(e[2]);return{map:r,x:a,real_x:a,y:n,real_y:n}}findDoorPath(t,e,r=new Set,a=new Set){if(r.add(t),t.map==e.map){const a=distance(t,e),n=[];for(const t of r)n.push(t);return n.push(e),[a,n]}const n=[...G.maps[t.map].doors];for(const e of G.maps[t.map].npcs)if("transporter"===e.id){for(const r in G.npcs.transporter.places)r!=t.map&&n.push([e.position[0],e.position[1],-1,-1,r,G.npcs.transporter.places[r]]);break}let i,o=Number.MAX_VALUE;for(const s of n){const n=s[4];if(a.has(n))continue;if(s[7]||s[8])continue;const c={map:t.map,x:s[0],y:s[1],key:`${t.map}.${s[0]}.${s[1]}`,transportS:s[5],transportMap:n,transportType:-1==s[3]?"teleport":"door"},p={map:n,x:G.maps[n].spawns[s[5]][0],y:G.maps[n].spawns[s[5]][1],key:`${n}.${G.maps[n].spawns[s[5]][0]}.${G.maps[n].spawns[s[5]][1]}`},h=new Set(a);h.add(n);const l=new Set(r);l.add(c);const m=distance(t,c)+50;if(o<m)continue;const[u,f]=this.findDoorPath(p,e,l,h);o>u+m&&(o=u+m,i=f)}return[o,i]}heuristic(t,e){return distance(t,e)}smoothPath(t){let e=[];e.push(t[0]);for(let r=0;r<t.length-1;r++){const a=t[r];if("town"==a.transportType){e.push(a);break}let n=r+1;for(let e=r+1;e<t.length;e++){const i=t[e];can_move({map:a.map,x:i.x,y:i.y,going_x:a.x,going_y:a.y,base:parent.character.base})&&(n=e,r=e-1)}n>0&&e.push(t[n])}return e=e.reverse(),e}reconstructPath(t,e,r){const a=[];for(a.push({map:e.map,x:e.x,real_x:e.x,y:e.y,real_y:e.y,key:`${e.map}.${e.x}.${e.y}`,transportMap:e.transportMap,transportType:e.transportType,transportS:e.transportS});t;)a.push({map:t.map,x:t.x,real_x:t.x,y:t.y,real_y:t.y,key:`${t.map}.${t.x}.${t.y}`,transportMap:t.transportMap,transportType:t.transportType,transportS:t.transportS}),t=r.get(t.key);return this.smoothPath(a)}smartMove(t,e=0){return s(this,void 0,void 0,(function*(){this.reset(),this.startDate=new Date;let r=[];const a=Date.now();this.SHOW_MESSAGES&&game_log("a* - start searching",this.MESSAGE_COLOR);const n=this.findDoorPath(this.cleanPosition(parent.character),this.cleanPosition(t))[1];for(let t=0;t<n.length;t+=2){const a=n[t],i=n[t+1],o=`${a.key}_${i.key}`;let s;this.doorCache.has(o)?s=this.doorCache.get(o):(s="door"==i.transportType?yield this.getMovements(a,i,this.DOOR_TOLERANCE):"teleport"==i.transportType?yield this.getMovements(a,i,this.TELEPORT_TOLERANCE):yield this.getMovements(a,i,e),this.doorCache.set(o,s)),r=r.concat(s)}this.SHOW_MESSAGES&&game_log(`a* - finish searching (${((Date.now()-a)/1e3).toFixed(1)} s)`,this.MESSAGE_COLOR);let i=0;const o=new Promise((t,e)=>{const a=n=>{if(this.wasCancelled(n))return stop(),e("a* - cancelled moving");const o=r[i];if(distance(parent.character,r[r.length-1])<this.MOVE_TOLERANCE)return this.SHOW_MESSAGES&&game_log("a* - done moving",this.MESSAGE_COLOR),this.finishedDate=new Date,void t();if(parent.character.moving||is_transporting(parent.character)||!can_walk(parent.character));else{if(o.map==parent.character.map&&this.USE_BLINK&&can_use("blink")&&distance(parent.character,o)>this.TOWN_MOVEMENT_COST&&parent.character.mp>G.skills.blink.mp){let t=i;for(;t<r.length&&r[t].map===parent.character.map;t++);return i=t-1,setTimeout(()=>{a(n)},900),void use_skill("blink",[r[i].x,r[i].y])}if(o.map==parent.character.map&&"town"==o.transportType)return distance(parent.character,o)<this.TOWN_TOLERANCE?(i+=1,void a(n)):(setTimeout(()=>{a(n)},900),void use_skill("town"));if(parent.character.map!=o.map||!can_move_to(o.x,o.y)){if(this.SHOW_MESSAGES&&game_log("a* - failed moving",this.MESSAGE_COLOR),this.MOVE_ON_FAIL){const t=2*Math.random()-1,e=2*Math.random()-1;move(parent.character.real_x+t,parent.character.real_y+e)}return this.reset(),e("failed moving")}if(distance(parent.character,o)<this.MOVE_TOLERANCE){if("door"!=o.transportType&&"teleport"!=o.transportType)return i+=1,void a(n);if(parent.character.map==o.map)return transport(o.transportMap,o.transportS),i+=1,void setTimeout(()=>{a(n)},100)}else move(o.x,o.y)}setTimeout(()=>{a(n)},40)};this.SHOW_MESSAGES&&game_log("a* - start moving",this.MESSAGE_COLOR),a(this.startDate)});return yield o}))}getMovements(t,e,r=0,a=this.startDate){return s(this,void 0,void 0,(function*(){const o=this.cleanPosition(t),s=this.cleanPosition(e),c=new Map,p=new Map;p.set(o.key,0);const h=new Map;h.set(o.key,this.heuristic(o,s));const l=new n.a((t,e)=>h.get(t.key)<h.get(e.key));l.add(Object.assign({},o));const m=new Set,u=this.cleanPosition({map:o.map,x:G.maps[o.map].spawns[0][0],y:G.maps[o.map].spawns[0][1],transportType:"town"}),f=p.get(o.key)+this.TOWN_MOVEMENT_COST;u.key!==o.key&&(!p.get(u.key)||f<p.get(u.key))&&(c.set(u.key,o),p.set(u.key,f),h.set(u.key,f+this.heuristic(u,s)),m.has(u.key)||(m.add(u.key),l.add(u)));let g=Date.now();for(;l.size;){const t=l.poll();m.delete(t.key);const e=distance(t,s);if(e<r){const e=this.reconstructPath(t,Object.assign(Object.assign({},t),{transportType:s.transportType,transportMap:s.transportMap,transportS:s.transportS}),c);return Promise.resolve(e)}if(e<r+this.FINISH_CHECK_DISTANCE)if(0==r){if(can_move({map:t.map,x:t.x,y:t.y,going_x:s.x,going_y:s.y,base:parent.character.base})){const e=this.reconstructPath(t,s,c);return Promise.resolve(e)}}else{const e=Math.atan2(t.y-s.y,t.x-s.x),a=s.x+Math.cos(e)*r,n=s.y+Math.sin(e)*r,i={map:s.map,x:a,y:n,key:this.positionToString({x:a,y:n,map:s.map}),transportMap:s.transportMap,transportType:s.transportType,transportS:s.transportS};if(can_move({map:t.map,x:t.x,y:t.y,going_x:i.x,going_y:i.y,base:parent.character.base})){const e=this.reconstructPath(t,i,c);return Promise.resolve(e)}}for(const e of this.MOVEMENTS)for(const r of e){const e=this.cleanPosition({map:t.map,x:Math.trunc(t.x+r[0]),y:Math.trunc(t.y+r[1])});if(can_move({map:t.map,x:t.x,y:t.y,going_x:e.x,going_y:e.y,base:parent.character.base})){const a=p.get(t.key)+Math.abs(r[0])+Math.abs(r[1]);(!p.has(e.key)||a<p.get(e.key))&&(c.set(e.key,t),p.set(e.key,a),h.set(e.key,a+this.heuristic(e,s)),m.has(e.key)||(m.add(e.key),l.add(e)))}}if(Date.now()-g>this.SLEEP_AFTER_MS&&(yield Object(i.r)(this.SLEEP_FOR_MS),g=Date.now(),this.wasCancelled(a)))return Promise.reject("cancelled")}this.SHOW_MESSAGES&&game_log("a* - failed searching",this.MESSAGE_COLOR);try{let t,e=Number.MAX_VALUE;for(const[r,a]of h){const n=p.get(r);a-n<e&&(e=a-n,t=r)}const r=this.stringToPosition(t),a=this.reconstructPath(r,s,c);return Promise.resolve(a)}catch(t){return Promise.reject("Failed to find a path...")}}))}}var p=function(t,e,r,a){return new(r||(r=Promise))((function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))};class h{constructor(){this.astar=new c,this.itemsToKeep=["computer","tracker","goldbooster","luckbooster","xpbooster","hpot1","mpot1","jacko","lantern"],this.itemsToSell={shoes:2,pants:2,coat:2,helmet:2,gloves:2,cclaw:2,hpamulet:1,hpbelt:1,maceofthedead:2,ringsj:1,slimestaff:2,spear:2,throwingstars:2,vitearring:1,vitring:1},this.itemsToDismantle={},this.itemsToExchange=new Set(["5bucks","gem0","gem1","seashell","leather","candycane","mistletoe","ornament","candy0","candy1","redenvelopev3","basketofeggs","armorbox","bugbountybox","gift0","gift1","mysterybox","weaponbox","xbox"]),this.itemsToBuy=new Set([...this.itemsToExchange,"dexbelt","intbelt","strbelt","ctristone","dexring","intring","ringofluck","strring","suckerpunch","tristone","dexearring","intearring","lostearring","strearring","amuletofm","dexamulet","intamulet","snring","stramulet","t2dexamulet","t2intamulet","t2stramulet","charmer","ftrinket","jacko","orbg","orbofdex","orbofint","orbofsc","orbofstr","rabbitsfoot","talkingskull","t2quiver","lantern","mshield","quiver","xshield","angelwings","bcape","cape","ecape","stealthcape","hboots","mrnboots","mwboots","shoes1","wingedboots","xboots","hpants","mrnpants","mwpants","pants1","starkillers","xpants","cdragon","coat1","harmor","mcape","mrnarmor","mwarmor","tshirt0","tshirt1","tshirt2","tshirt3","tshirt4","tshirt6","tshirt7","tshirt8","tshirt88","tshirt9","warpvest","xarmor","eears","fury","helmet1","hhelmet","mrnhat","mwhelmet","partyhat","rednose","xhelmet","gloves1","goldenpowerglove","handofmidas","hgloves","mrngloves","mwgloves","poker","powerglove","xgloves","basher","bataxe","bowofthedead","candycanesword","carrotsword","crossbow","dartgun","firebow","frostbow","froststaff","gbow","harbringer","hbow","merry","oozingterror","ornamentstaff","pmace","t2bow","t3bow","wblade","ascale","bfur","cscale","electronics","feather0","fireblade","goldenegg","goldingot","goldnugget","leather","networkcard","platinumingot","platinumnugget","pleather","snakefang","x0","x1","x2","x3","x4","x5","x6","x7","x8","egg0","egg1","egg2","egg3","egg4","egg5","egg6","egg7","egg8","essenceofether","essenceoffire","essenceoffrost","essenceoflife","essenceofnature","bunnyelixir","candypop","elixirdex0","elixirdex1","elixirdex2","elixirint0","elixirint1","elixirint2","elixirluck","elixirstr0","elixirstr1","elixirstr2","greenbomb","hotchocolate","cscroll3","scroll3","scroll4","bottleofxp","bugbountybox","monstertoken","poison","snakeoil"]),this.holdPosition=!1,this.holdAttack=!1}mainLoop(){return p(this,void 0,void 0,(function*(){try{if("merchant"!=parent.character.ctype&&(this.equipBetterItems(),this.getMonsterhuntQuest(),yield Object(o.b)()),this.getNewYearTreeBuff(),Object(o.e)(this.itemsToDismantle),null==parent.character.slots.elixir){const t=Object(i.d)("candypop");t.length&&equip(t[0].index)}for(const t of Object(i.i)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];r&&(r.giveaway&&(r.list.includes(parent.character.id)||parent.socket.emit("join_giveaway",{slot:e,id:t.id,rid:r.rid})))}for(const t of Object(i.i)({isCtype:"merchant",isWithinDistance:400}))for(const e in t.slots){const r=t.slots[e];if(r&&(!r.b&&r.rid&&this.itemsToBuy.has(r.name)&&!(r.price>2*G.items[r.name].g||parent.character.gold<r.price)))if(r.q){const a=Math.min(r.q,Math.floor(parent.character.gold/r.price));parent.socket.emit("trade_buy",{slot:e,id:t.id,rid:r.rid,q:a})}else parent.socket.emit("trade_buy",{slot:e,id:t.id,rid:r.rid,q:1})}this.loot()}catch(t){console.error(t)}setTimeout(()=>{this.mainLoop()},Math.max(250,parent.character.ping))}))}run(){this.healLoop(),this.attackLoop(),this.scareLoop(),this.moveLoop(),this.infoLoop(),this.mainLoop()}infoLoop(){const t=JSON.parse(sessionStorage.getItem("party"),i.q);t[parent.character.name]={lastSeen:new Date,shouldSwitchServer:this.shouldSwitchServer(),monsterHuntTargets:this.getMonsterHuntTargets(),items:Object(i.j)(),attack:parent.character.attack,frequency:parent.character.frequency,goldm:parent.character.goldm,last_ms:parent.character.last_ms,luckm:parent.character.luckm,map:parent.character.map,x:parent.character.real_x,y:parent.character.real_y,s:parent.character.s},sessionStorage.setItem("party",JSON.stringify(t));const e=JSON.parse(sessionStorage.getItem("players"),i.q);for(const t of Object(i.i)({isPlayer:!0}))e[t.id]={lastSeen:new Date,rip:t.rip,map:t.map,x:t.real_x,y:t.real_y,s:t.s,ctype:t.ctype};sessionStorage.setItem("players",JSON.stringify(e));const r=JSON.parse(sessionStorage.getItem("npcs"),i.q);for(const t of["Angel","Kane"])parent.entities[t]&&(r[t]={lastSeen:new Date,map:parent.entities[t].map,x:parent.entities[t].real_x,y:parent.entities[t].real_y});sessionStorage.setItem("npcs",JSON.stringify(r));const a=JSON.parse(sessionStorage.getItem("monsters"),i.q);for(const t of Object(i.i)({isMonster:!0}))["goldenbat","phoenix","snowman"].includes(t.mtype)&&(a[t.mtype]={lastSeen:new Date,id:t.id,x:t.real_x,y:t.real_y,map:t.map});sessionStorage.setItem("monsters",JSON.stringify(a)),setTimeout(()=>{this.infoLoop()},5e3)}getMonsterHuntTargets(){const t=[];let e=Number.MAX_VALUE;const r=JSON.parse(sessionStorage.getItem("party"),i.q);for(const a of parent.party_list){const n=r[a];if(!n)continue;if(!n.s.monsterhunt||0==n.s.monsterhunt.c)continue;if(!this.targetPriority[n.s.monsterhunt.id])continue;const o=this.targetPriority[n.s.monsterhunt.id].coop;if(o){const t=Object(i.k)();if(o.filter(e=>!t.has(e)).length)continue}const s=n.s.monsterhunt.ms-(Date.now()-new Date(n.last_ms).getTime());s<e?(e=s,t.unshift(n.s.monsterhunt.id)):t.push(n.s.monsterhunt.id)}return t}shouldSwitchServer(){if("merchant"==parent.character.ctype)return!0;if(!parent.character.s.monsterhunt)return!1;if(0==parent.character.s.monsterhunt.c)return!1;if(this.getMonsterHuntTargets().length)return!1;for(const t in parent.S)if("grinch"!=t&&!(parent.S[t].hp/parent.S[t].max_hp>.9)&&parent.S[t].live&&this.targetPriority[t])return!1;return!0}loot(){let t=0;const e=JSON.parse(sessionStorage.getItem("party"),i.q);for(const r in parent.chests){const a=parent.chests[r];if(distance(parent.character,a)>800)continue;let n=!0;for(const t of parent.party_list){if(t==parent.character.id)continue;const r=parent.entities[t];if(r&&(!(distance(r,a)>800)&&e[t])){if(["chest3","chest4"].includes(a.skin)){if(parent.character.goldm>=e[t].goldm)continue}else if(parent.character.luckm>=e[t].luckm)continue;n=!1;break}}if(n&&(parent.socket.emit("open_chest",{id:r}),++t>10))break}}attackLoop(){return p(this,void 0,void 0,(function*(){try{const t=this.getTargets(1);t.length&&this.wantToAttack(t[0])&&(yield attack(t[0]),reduce_cooldown("attack",Math.min(...parent.pings)))}catch(t){return"cooldown"==t.reason?void setTimeout(()=>{this.attackLoop()},Math.min(...parent.pings)-t.remaining):(["not_found","disabled"].includes(t.reason)||console.error(t),void setTimeout(()=>{this.attackLoop()},Object(i.f)("attack")))}setTimeout(()=>{this.attackLoop()},Object(i.f)("attack",!0))}))}scareLoop(){try{const t=Object(i.i)({isAttackingUs:!0,isMonster:!0,isRIP:!1});let e=!1;if(t.length>=3)e=!0;else if(t.length&&!this.targetPriority[t[0].mtype])e=!0;else if(parent.character.c.town&&(t.length>1||1==t.length&&distance(t[0],parent.character)-t[0].range-2*t[0].speed))e=!0;else for(const r of t)if(!(distance(r,parent.character)>r.range||6*Object(i.b)(r,parent.character)[1]*r.frequency<=parent.character.hp)){e=!0;break}if(!Object(i.n)("scare")||!e)return void setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"));if("jacko"==parent.character.slots.orb.name)use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings));else{const t=Object(i.d)("jacko");if(t.length){const e=t[0].index;equip(e),use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings))}}}catch(t){console.error(t)}setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"))}getMovementLocation(t){if(!this.targetPriority[t])return;if(this.targetPriority[t].farmingPosition&&this.targetPriority[t].holdPositionFarm)return this.targetPriority[t].farmingPosition;if(Object(i.m)().has(t))return;if(this.targetPriority[t].farmingPosition)return distance(parent.character,this.targetPriority[t].farmingPosition)<300?void 0:this.targetPriority[t].farmingPosition;if(parent.S[t]){if(!parent.S[t].live)return;return parent.S[t]}const e=Object(i.l)(t);return e||void 0}getMovementTarget(){if(parent.character.rip)return void set_message("RIP");if(parent.character.s.monsterhunt&&0==parent.character.s.monsterhunt.c)return set_message("Finish MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300};for(const t of Object(i.i)({isMonster:!0,isRIP:!1}))if(("goldenbat"==t.mtype||"phoenix"==t.mtype)&&this.targetPriority[t.mtype])return set_message(t.mtype),{target:t.mtype,position:t,range:parent.character.range};const t=JSON.parse(sessionStorage.getItem("monsters"),i.q);for(const e in t){if(!this.targetPriority[e])continue;const r=t[e],a=parent.entities[r.id];if(a&&(r.x=a.real_x,r.y=a.real_y),!(distance(parent.character,r)<100)||a)return set_message("SP "+e),{target:e,position:r,range:0};delete t[e],sessionStorage.setItem("monsters",JSON.stringify(t))}if(G.maps.main.ref.newyear_tree&&!parent.character.s.holidayspirit)return set_message("Xmas Tree"),{target:"newyear_tree",position:G.maps.main.ref.newyear_tree,range:300};if(Object(i.o)())return set_message("Full!"),{target:"merchant",position:{map:"main",x:60,y:-325},range:300};for(const t in parent.S)if(parent.S[t].live&&this.targetPriority[t])return set_message(t),{target:t,position:parent.S[t],range:parent.character.range};const e=JSON.parse(sessionStorage.getItem("party"),i.q),r=this.getMonsterHuntTargets();if(r.length){const t=r[0],a=this.targetPriority[t].coop;if(!a)return set_message("MH "+t),{target:t,position:this.getMovementLocation(t)};{const r=new Set;for(const a of parent.party_list)e[a]&&e[a].monsterHuntTargets&&e[a].monsterHuntTargets[0]==t&&r.add(parent.party[a].type);if(0==a.filter(t=>!r.has(t)).length)return set_message("MH "+t),{target:t,position:this.getMovementLocation(t)}}}return parent.character.s.monsterhunt?this.mainTarget?(set_message(this.mainTarget),{target:this.mainTarget,position:this.getMovementLocation(this.mainTarget)}):void 0:(set_message("New MH"),{target:"monsterhunter",position:G.maps.main.ref.monsterhunter,range:300})}moveLoop(){try{if(this.holdPosition||smart.moving)return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));const t=this.movementTarget;if(this.movementTarget=this.getMovementTarget(),this.movementTarget&&this.movementTarget.position){if(!t||this.movementTarget.target!=t.target||t.position&&this.movementTarget.position.map!=t.position.map)return this.astar.stop(),this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));if(!this.astar.isMoving())return this.astar.smartMove(this.movementTarget.position,this.movementTarget.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}const e=this.getTargets(1);e.length&&e[0].mtype==this.movementTarget.target&&this.targetPriority[e[0].mtype]&&!this.targetPriority[e[0].mtype].holdPositionFarm&&this.astar.stop();const r=get_targeted_monster();if(r&&r.rip&&(change_target(null,!0),this.astar.stop()),this.astar.isMoving())return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));if(this.targetPriority[this.movementTarget.target]&&this.targetPriority[this.movementTarget.target].holdPositionFarm)return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));const a=[],n=[],o=[],s=[],c=[],p=[],h=[],l=[];for(const t in parent.entities){const e=parent.entities[t];if(e.rip)continue;if(!this.targetPriority[e.mtype])continue;const r=distance(parent.character,e),m=Math.max(e.range+e.speed,50);m<parent.character.range&&r<m&&(e.hp>Object(i.b)(parent.character,e)[0]||this.targetPriority[e.mtype].holdAttackInEntityRange||e.target==parent.character.name)&&a.push(e),!e.target&&r<50&&n.push(e),r<parent.character.range?(o.push(e),this.movementTarget.target==e.mtype&&s.push(e)):r<2*parent.character.range&&(c.push(e),this.movementTarget.target==e.mtype&&p.push(e)),h.push(e),this.movementTarget.target==e.mtype&&l.push(e)}if(a.length){const t={x:0,y:0};let e=0;for(const r of a)t.x+=r.real_x,t.y+=r.real_y,r.range+r.speed>e&&(e=r.range+r.speed);t.x/=a.length,t.y/=a.length;const r=Math.atan2(parent.character.real_y-t.y,parent.character.real_x-t.x),n=Math.min(parent.character.range,1.5*e),i=(t,e)=>{const r=Math.cos(t)*e,a=Math.sin(t)*e;return{x:parent.character.real_x+r,y:parent.character.real_y+a}};let o=i(r,n),s=0;for(;!can_move_to(o.x,o.y)&&s<180;)s=s<=0?1-s:-s,o=i(r+s*Math.PI/180,n);return move(o.x,o.y),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}if(s.length)return void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping));if(l.length){let t,e=Number.MAX_VALUE;for(const r of l){const a=distance(parent.character,r);a<e&&(e=a,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}if(h.length){let t,e=Number.MAX_VALUE;for(const r of h){const a=distance(parent.character,r);a<e&&(e=a,t=r)}return this.astar.smartMove(t,parent.character.range),void setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}}catch(t){console.error(t)}setTimeout(()=>{this.moveLoop()},Math.max(400,parent.character.ping))}healLoop(){return p(this,void 0,void 0,(function*(){try{if(parent.character.rip)return respawn(),void setTimeout(()=>{this.healLoop()},Object(i.f)("use_town"));if(!Object(i.n)("use_hp"))return void setTimeout(()=>{this.healLoop()},Object(i.f)("use_hp"));const t=["hpot0","hpot1"],e=["mpot0","mpot1"];let r=null,a=null;for(let n=parent.character.items.length-1;n>=0;n--){const i=parent.character.items[n];if(i&&(!a&&t.includes(i.name)?a=i:!r&&e.includes(i.name)&&(r=i),a&&r))break}const n=parent.character.hp/parent.character.max_hp,o=parent.character.mp/parent.character.max_mp;n<=o&&1!=n&&(!a||"hpot0"==a.name&&(parent.character.hp<=parent.character.max_hp-200||parent.character.hp<50)||"hpot1"==a.name&&(parent.character.hp<=parent.character.max_hp-400||parent.character.hp<50))?(use_skill("use_hp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):1!=o&&(!r||"mpot0"==r.name&&(parent.character.mp<=parent.character.max_mp-300||parent.character.mp<50)||"mpot1"==r.name&&(parent.character.mp<=parent.character.max_mp-500||parent.character.mp<50))?(use_skill("use_mp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):n<o?(use_skill("regen_hp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings))):o<n&&(use_skill("regen_mp"),reduce_cooldown("use_hp",Math.min(...parent.pings)),reduce_cooldown("use_mp",Math.min(...parent.pings)))}catch(t){console.error(t)}setTimeout(()=>{this.healLoop()},Object(i.f)("use_hp"))}))}getNewYearTreeBuff(){G.maps.main.ref.newyear_tree&&(parent.character.s.holidayspirit||distance(parent.character,G.maps.main.ref.newyear_tree)>400||parent.socket.emit("interaction",{type:"newyear_tree"}))}getMonsterhuntQuest(){distance(parent.character,G.maps.main.ref.monsterhunter)>400||(parent.character.s.monsterhunt?0==parent.character.s.monsterhunt.c&&parent.socket.emit("monsterhunt"):parent.socket.emit("monsterhunt"))}parseCM(t,e){if(parent.party_list.includes(t)||parent.character.name==t||["earthiverse","earthMag","earthMag2"].includes(t)||"monster"==e.message){if("info"==e.message){const r=JSON.parse(sessionStorage.getItem("party"),i.q);r[t]=e.info,sessionStorage.setItem("party",JSON.stringify(r))}else if("monster"==e.message){const t=JSON.parse(sessionStorage.getItem("monsters"),i.q);t[e.id]=e.info,sessionStorage.setItem("monsters",JSON.stringify(t))}else if("npc"==e.message){const t=JSON.parse(sessionStorage.getItem("npcs"),i.q);t[e.id]=e.info,sessionStorage.setItem("npcs",JSON.stringify(t))}else if("player"==e.message){const t=JSON.parse(sessionStorage.getItem("players"),i.q);t[e.id]=e.info,sessionStorage.setItem("players",JSON.stringify(t))}else if("chests"==e.message)for(const t in e.chests)parent.chests[t]||(parent.chests[t]=e.chests[t])}else game_log("Blocked CM from "+t)}equipBetterItems(){try{const t=Object(i.j)();if(this.movementTarget.target&&this.targetPriority[this.movementTarget.target])for(const e of this.targetPriority[this.movementTarget.target].equip||[]){let r=!1;for(const t in parent.character.slots){const a=parent.character.slots[t];if(a&&a.name==e){r=!0;break}}if(!r)for(const r of t)if(r.name==e){G.classes[parent.character.ctype].doublehand[G.items[e].wtype]&&unequip("offhand"),equip(r.index);break}}for(const e in parent.character.slots){let r,a=parent.character.slots[e];if(a){for(const e of t)e.name==a.name&&(!e.level||e.level<=a.level||(a=e,r=e));r&&equip(r.index,e)}}}catch(t){console.error(t)}}getTargets(t=1,e=parent.character.range){const r=[],a=parent.party_list,o=new Set;for(const t in parent.entities)if(a.includes(t)){const e=parent.entities[t].target;e&&o.add(e)}const s=new n.a((t,e)=>t.priority>e.priority);for(const t in parent.entities){const r=parent.entities[t];if(r.rip)continue;if(parent.party_list.includes(t))continue;if(!is_pvp()&&"monster"!=r.type)continue;if(is_pvp()&&parent.party_list.includes(t))continue;if(!this.targetPriority[r.mtype]&&r.target!=parent.character.name)continue;let a=this.targetPriority[r.mtype]?this.targetPriority[r.mtype].priority:0;const n=distance(parent.character,r);if(n>e)continue;a-=n,o.has(t)&&(this.targetPriority[r.mtype]&&this.targetPriority[r.mtype].coop&&(a+=parent.character.range),r.hp<=Object(i.b)(parent.character,r)[0]&&(a-=parent.character.range)),r.mtype==this.mainTarget&&(a+=250),this.movementTarget&&r.mtype==this.movementTarget.target&&(a+=1e3),r.target==parent.character.name&&(a+=2e3),r.cooperative&&(a+=1e3*(r.max_hp-r.hp)/r.max_hp);const c={id:r.id,priority:a};s.add(c)}for(;r.length<t&&s.size>0;){const t=parent.entities[s.poll().id];t&&r.push(t)}return r.length>0&&change_target(r[0],!0),r}wantToAttack(t,e="attack"){if(!Object(i.n)(e))return!1;if(parent.character.c.town)return!1;let r=G.skills[e].range?G.skills[e].range:parent.character.range;const a=distance(parent.character,t);if(G.skills[e].range_multiplier&&(r*=G.skills[e].range_multiplier),a>r)return!1;const n=G.skills[e].mp?G.skills[e].mp:parent.character.mp_cost;if(parent.character.mp<n)return!1;if("attack"!=e&&t.immune)return!1;if("attack"!=e&&t["1hp"])return!1;if(!is_pvp()&&"monster"==t.type&&!this.targetPriority[t.mtype])return!1;if(!t.target){if(this.holdAttack)return!1;if((smart.moving||this.astar.isMoving())&&this.movementTarget&&this.movementTarget.target&&this.movementTarget.target!=t.mtype&&this.targetPriority[t.mtype].holdAttackWhileMoving)return!1;if(this.targetPriority[t.mtype].holdAttackInEntityRange&&a<=t.range)return!1;if(this.targetPriority[t.mtype].coop){const e=[parent.character.ctype];for(const t of parent.party_list){const r=parent.entities[t];r&&(r.rip||"priest"==r.ctype&&distance(parent.character,r)>r.range||e.push(r.ctype))}for(const r of this.targetPriority[t.mtype].coop)if(!e.includes(r))return!1}if(5*Object(i.b)(t,parent.character)[1]*t.frequency>parent.character.hp&&a<=t.range)return!1}return!0}}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},,,,,function(t,e,r){"use strict";r.r(e),r.d(e,"warrior",(function(){return c}));var a=r(3),n=r(1),i=r(0),o=function(t,e,r,a){return new(r||(r=Promise))((function(n,i){function o(t){try{c(a.next(t))}catch(t){i(t)}}function s(t){try{c(a.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))};class s extends a.a{constructor(){super(),this.targetPriority={arcticbee:{priority:30,equip:["basher"]},bat:{priority:30,farmingPosition:{map:"cave",x:1250,y:-800},equip:["basher"]},bbpompom:{coop:["priest"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:10,farmingPosition:{map:"winter_cave",x:0,y:-100},equip:["basher"]},bee:{priority:30,equip:["bataxe"]},boar:{coop:["warrior","priest"],priority:10,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"winterland",x:0,y:-850},equip:["basher"]},crab:{priority:30,equip:["bataxe"]},crabx:{priority:20,equip:["basher"]},croc:{priority:30,equip:["basher"]},fireroamer:{coop:["priest"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"desertland",x:200,y:-700},equip:["basher"]},fvampire:{coop:["priest","ranger"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"halloween",x:-150,y:-1575},equip:["basher"]},ghost:{coop:["priest"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"halloween",x:400,y:-1100},equip:["basher"]},goldenbat:{priority:500,equip:["basher"]},goo:{priority:30,equip:["bataxe"]},greenjr:{priority:10,holdAttackInEntityRange:!0,holdAttackWhileMoving:!0,equip:["basher"]},iceroamer:{priority:10,equip:["basher"]},mechagnome:{coop:["priest","ranger"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:10,farmingPosition:{map:"cyberland",x:150,y:-100},equip:["basher"]},minimush:{priority:30,equip:["bataxe"]},mole:{coop:["priest","warrior"],holdPositionFarm:!0,holdAttackWhileMoving:!0,priority:10,farmingPosition:{map:"tunnel",x:0,y:-75},equip:["basher"]},mummy:{coop:["priest"],priority:10,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"spookytown",x:255,y:-1125},equip:["basher"]},oneeye:{coop:["ranger","priest"],priority:0,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"level2w",x:-150,y:0},equip:["basher"]},osnake:{priority:30,equip:["bataxe"]},phoenix:{priority:500,equip:["basher"]},pinkgoblin:{priority:100,holdAttackWhileMoving:!0,coop:["priest","ranger"],equip:["basher"]},pinkgoo:{priority:1e3,equip:["candycanesword","woodensword"]},poisio:{priority:20,equip:["basher"]},rat:{priority:30,equip:["basher"]},scorpion:{priority:20,equip:["basher"]},snake:{priority:30,farmingPosition:{map:"main",x:-74,y:1904},equip:["bataxe"]},snowman:{priority:500,equip:["candycanesword","woodensword"]},spider:{priority:20,equip:["basher"]},squig:{priority:30,equip:["bataxe"]},squigtoad:{priority:30},tortoise:{priority:30,equip:["basher"]},wolf:{coop:["priest"],priority:0,holdPositionFarm:!0,holdAttackWhileMoving:!0,farmingPosition:{map:"winterland",x:450,y:-2500},equip:["basher"]},wolfie:{coop:["warrior","priest"],priority:10,holdAttackWhileMoving:!0,holdPositionFarm:!0,farmingPosition:{map:"winterland",x:0,y:-1825},equip:["basher"]}},this.mainTarget="scorpion",this.itemsToKeep.push("basher","bataxe","candycanesword","carrotsword","fireblade","fsword","wblade","woodensword","mshield","shield","sshield","xshield")}run(){super.run(),this.agitateLoop(),this.chargeLoop(),this.hardshellLoop(),this.cleaveLoop(),this.stompLoop(),this.warcryLoop(),this.tauntLoop()}mainLoop(){const t=Object.create(null,{mainLoop:{get:()=>super.mainLoop}});return o(this,void 0,void 0,(function*(){try{Object(n.j)("earthMer",this.itemsToKeep),Object(n.i)("earthMer",1e5),Object(n.h)(this.itemsToSell),t.mainLoop.call(this)}catch(t){console.error(t),setTimeout(()=>{this.mainLoop()},250)}}))}scareLoop(){try{const t=Object(i.i)({isAttackingUs:!0,isRIP:!1,isMonster:!0});let e=!1;if(t.length>=4)e=!0;else if(t.length&&!this.targetPriority[t[0].mtype])e=!0;else if(t.length&&parent.character.c.town)e=!0;else for(const r of t)if(!(distance(r,parent.character)>r.range||6*Object(i.b)(r,parent.character)[1]*r.frequency<=parent.character.hp)){e=!0;break}if(!Object(i.n)("scare")||!e)return void setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"));if("jacko"==parent.character.slots.orb.name)use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings));else{const t=Object(i.d)("jacko");if(t.length){const e=t[0].index;equip(e),use_skill("scare"),reduce_cooldown("scare",Math.min(...parent.pings))}}}catch(t){console.error(t)}setTimeout(()=>{this.scareLoop()},Object(i.f)("scare"))}agitateLoop(){try{if(Object(i.n)("agitate")){let t=0,e=0;for(const r in parent.entities){const a=parent.entities[r];if("monster"==a.type&&(!a.rip&&(!a.target||parent.party_list.includes(a.target))&&!(distance(parent.character,a)>G.skills.agitate.range))){if(!this.targetPriority[a.mtype]){t=10,e=9999;break}t++,e+=Object(i.b)(a,parent.character)[1]}}t>0&&t<=3&&e<1e3&&(use_skill("agitate"),reduce_cooldown("agitate",Math.min(...parent.pings)))}}catch(t){console.error(t)}setTimeout(()=>{this.agitateLoop()},Object(i.f)("agitate"))}warcryLoop(){if(Object(i.n)("warcry")){let t=0;for(const e of parent.party_list){const r=parent.entities[e];if(r&&("merchant"!=r.ctype&&(distance(parent.character,r)<G.skills.warcry.range&&(t+=1),2==t))){use_skill("warcry"),reduce_cooldown("warcry",Math.min(...parent.pings));break}}}setTimeout(()=>{this.warcryLoop()},Object(i.f)("warcry"))}stompLoop(){const t=Object(i.i)({isAttackingUs:!0,isRIP:!1});Object(i.n)("stomp")&&t.length&&t[0].hp>25e3&&distance(parent.character,t[0])<parent.character.range&&(use_skill("stomp"),reduce_cooldown("stomp",Math.min(...parent.pings))),setTimeout(()=>{this.stompLoop()},Object(i.f)("stomp"))}cleaveLoop(){const t=[],e=[];for(const r of Object(i.i)({isMonster:!0,isRIP:!1,isWithinDistance:G.skills.cleave.range}))parent.character.attack<Object(i.b)(parent.character,r)[0]?e.push(r):this.targetPriority[r.mtype]?this.wantToAttack(r,"cleave")&&t.push(r):e.push(r);let r=0;for(const t of e)r+=Object(i.b)(t,parent.character)[1];Object(i.n)("cleave")&&t.length>3&&r<1e3&&(use_skill("cleave"),reduce_cooldown("cleave",Math.min(...parent.pings))),setTimeout(()=>{this.cleaveLoop()},Object(i.f)("cleave"))}chargeLoop(){Object(i.n)("charge")&&use_skill("charge"),setTimeout(()=>{this.chargeLoop()},Object(i.f)("charge"))}hardshellLoop(){const t=Object(i.i)({isAttackingUs:!0,isRIP:!1});Object(i.n)("hardshell")&&t.length&&distance(t[0],parent.character)<=t[0].range&&parent.character.hp<5*Object(i.b)(t[0],parent.character)[1]&&(use_skill("hardshell"),reduce_cooldown("hardshell",Math.min(...parent.pings))),setTimeout(()=>{this.hardshellLoop()},Object(i.f)("hardshell"))}tauntLoop(){return o(this,void 0,void 0,(function*(){try{let t=0;const e=Object(i.i)({isAttackingUs:!0,isRIP:!1,isMonster:!0});for(const r of e)t+=Object(i.b)(r,parent.character)[1];if(t<1e3&&e.length<3){const e=Object(i.i)({isAttackingParty:!0,isAttackingUs:!1,isMonster:!0,isRIP:!1,isWithinDistance:G.skills.taunt.range});for(const r of e){if(!this.wantToAttack(r,"taunt"))continue;if(!(t+Object(i.b)(r,parent.character)[1]>1e3))return yield use_skill("taunt",r),reduce_cooldown("taunt",Math.min(...parent.pings)),void setTimeout(()=>{this.tauntLoop()},Object(i.f)("taunt"))}const r=Object(i.i)({isAttackingParty:!1,isMonster:!0,isRIP:!1,isWithinDistance:G.skills.taunt.range});for(const e of r){if(!this.wantToAttack(e,"taunt"))continue;if(!(t+Object(i.b)(e,parent.character)[1]>1e3)&&!(distance(parent.character,e)>parent.character.range&&e.range>4*parent.character.range))return yield use_skill("taunt",e),reduce_cooldown("taunt",Math.min(...parent.pings)),void setTimeout(()=>{this.tauntLoop()},Object(i.f)("taunt"))}}}catch(t){console.error(t)}setTimeout(()=>{this.tauntLoop()},Object(i.f)("taunt"))}))}}const c=new s}]);